<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.rcode.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#abc","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="你可以跑,但你不能躲">
<meta property="og:type" content="website">
<meta property="og:title" content="Rick-Code">
<meta property="og:url" content="http://www.rcode.top/page/3/index.html">
<meta property="og:site_name" content="Rick-Code">
<meta property="og:description" content="你可以跑,但你不能躲">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="河神">
<meta property="article:tag" content="瑞克和莫蒂">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.rcode.top/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Rick-Code</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rick-Code</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日行一步，且得人生半日闲</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

  
    
  <div class="back-to-top">
      <svg t="1610624158144" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2798" width="80" height="80"><path d="M463.04 956.96a177.6 177.6 0 0 1-37.44-3.04c-9.6-2.24-24-6.88-40.64-12.48a447.04 447.04 0 0 0-64-18.08l-16-0.8c-37.44-1.6-84-3.52-86.24-41.76-1.6-28 24.16-69.76 46.24-99.68A224.96 224.96 0 0 1 288 754.72a261.76 261.76 0 0 1-44.8-56.32h-1.6a113.92 113.92 0 0 1-104.16-68.8A102.4 102.4 0 0 1 128 547.52a87.2 87.2 0 0 1 25.6-37.12c-7.52-33.44-20.8-103.84-12-160A210.08 210.08 0 0 1 192 240c9.92-25.44 51.04-106.56 186.08-151.04a473.44 473.44 0 0 1 145.92-22.4c170.72 0 290.72 80 321.12 214.24s27.84 208 21.44 242.24A80 80 0 0 1 896 615.2c-16 55.2-74.72 67.68-102.56 70.56a513.12 513.12 0 0 1-37.76 46.4c-4 4.16-7.84 7.84-11.52 11.2 28.48 25.28 68.8 64 79.2 91.36a90.24 90.24 0 0 1-2.24 71.36 57.44 57.44 0 0 1-29.44 30.08l-2.24 0.8a226.88 226.88 0 0 1-91.36 14.56c-9.92 0-20.64 0-32-1.12-24.8-1.6-42.24-3.04-55.52-4.16S588.64 944 581.28 944a128 128 0 0 0-28.16 3.68 480 480 0 0 1-90.08 9.28z" fill="#FFFFFF" p-id="2799"></path><path d="M184.64 522.24s-27.04-97.92-16-167.04a171.84 171.84 0 0 1 47.04-99.2S240 163.36 386.56 115.36s388-23.04 432 172.64 16 250.08 16 250.08A55.2 55.2 0 0 1 870.56 608c-16 52.96-91.04 52-91.04 52A559.04 559.04 0 0 1 736 713.28a126.72 126.72 0 0 1-36 28s84.96 68.96 98.08 103.04-5.92 63.04-15.04 66.08-35.04 18.08-116 12.96-81.92-9.92-120-1.92A368 368 0 0 1 432 928c-21.92-4.96-84-28.96-108-31.04S247.68 896 246.56 880s19.04-52.64 41.44-82.72a167.68 167.68 0 0 1 44-43.04 211.36 211.36 0 0 1-72.96-84.96s-61.92 16.96-96.96-52 22.56-95.04 22.56-95.04z" fill="#1D1D1B" p-id="2800"></path><path d="M206.56 505.28s-36.96-108-11.04-159.04 28.48-56 28.48-56 44.96-103.04 139.04-134.08S592 98.24 705.6 168.32s114.08 302.08 112.96 315.04-4 14.08-4 14.08a316.8 316.8 0 0 0-51.04-171.04c-55.04-84-120.96-140.96-247.04-139.04S281.6 288 273.6 308.32s-15.04 34.08-15.04 34.08-13.92-20.96-16.96-20.96-11.04 4-8.96 10.08 16.96 22.08 16.96 26.08a75.36 75.36 0 0 1-4 15.04s-24-21.92-28-19.04-4 16-4 16 23.04 24 22.08 27.04a272 272 0 0 0-17.92 64.96 129.28 129.28 0 0 1-11.2 43.68z" fill="#7B5207" p-id="2801"></path><path d="M212.64 552.32s12.96 36.96 20 54.08a112 112 0 0 1 8 31.04 61.6 61.6 0 0 1-49.92-36.96c-13.12-34.24 17.28-44.16 21.92-48.16zM818.56 563.36s-4.96 20-11.04 42.08a116.64 116.64 0 0 1-12 31.04s46.08-3.04 52-29.92a36 36 0 0 0-28.96-43.2zM530.56 218.24c82.08 0 176.96 44.96 227.04 163.04s39.04 236.96-32.96 303.04-136.96 106.08-259.04 87.04-171.04-87.04-208-171.04S240 220.32 530.56 218.24z" fill="#FCD396" p-id="2802"></path><path d="M355.68 768c8.64-6.4 60.96 47.04 179.04 35.04s135.04-43.04 140-43.04 87.04 60.96 98.08 86.08 8.96 42.08 4 43.04a60.8 60.8 0 0 1-13.92 0s-51.04-83.04-60.96-84-12.96 2.08-11.04 7.04 52.96 80 50.08 80.96-12 8.96-17.92 4.96S676.64 832 672 832s-16 3.04-15.04 6.08 46.08 63.04 42.08 64.96a106.24 106.24 0 0 1-23.04 2.08s-40-59.04-45.92-59.04-9.92 10.08-9.92 10.08 35.04 52 31.04 52a334.08 334.08 0 0 0-83.04-9.92c-40 2.08-71.04 18.08-105.92 14.08S384 880 349.6 878.24s-67.04-1.92-68-5.92 10.08-56.32 74.08-104.32z" fill="#FAB900" p-id="2803"></path><path d="M339.68 349.28c-7.36 0 92.96-20 98.08-13.92s8.96 14.08 0.96 14.08-84.16 18.56-91.04 16.8-7.04-16.96-8-16.96zM637.6 339.36c4 0 88 12 88.96 19.04s7.04 8.96-3.04 10.08a736 736 0 0 1-85.92-13.92c-7.04-2.56 0-15.2 0-15.2zM378.56 379.36c55.04-13.12 132-7.04 128.96 91.04s-117.92 114.08-172.96 75.04-56.96-142.08 44-166.08z" fill="#1D1D1B" p-id="2804"></path><path d="M382.24 393.12c46.56-11.04 112-5.92 109.28 77.12s-100 96-146.56 64-48.32-120.8 37.28-141.12z" fill="#FFFFFF" p-id="2805"></path><path d="M614.56 382.24c48-25.28 127.04 2.08 130.08 91.04s-96.96 108-147.04 67.04-60-116.96 16.96-158.08z" fill="#1D1D1B" p-id="2806"></path><path d="M620.96 396.96c39.36-20.96 105.12 1.6 107.52 75.36s-80 89.44-121.6 55.36-49.6-96.8 14.08-130.72z" fill="#FFFFFF" p-id="2807"></path><path d="M392.64 450.24c14.56-11.36 40-7.04 40.96 12a27.2 27.2 0 0 1-37.92 28.96c-25.12-8.96-11.68-33.92-3.04-40.96zM641.6 450.24c14.56-11.36 40-7.04 40.96 12a27.2 27.2 0 0 1-37.92 28.96c-24.96-8.96-12-33.92-3.04-40.96zM508.64 582.24c4.32 0.8 62.08 35.04 70.08 30.08s2.08-28-8-36-8.96-3.04-9.92-8a6.24 6.24 0 0 1 7.04-8 44 44 0 0 1 34.08 36.96c4.96 30.08-12.96 39.04-36.96 32.96a217.44 217.44 0 0 1-65.92-36.96c-3.04-4 4.64-12 9.6-11.04zM416 660.32c7.04-0.96 34.08 34.08 103.04 31.04a293.6 293.6 0 0 0 80-12 15.04 15.04 0 0 1 12 14.08c-0.96 3.04-45.92 22.08-113.92 16-71.36-6.24-91.04-32.96-92.96-36.96s4.48-11.2 11.84-12.16z" fill="#1D1D1B" p-id="2808"></path></svg>
      <svg t="1610639708230" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2073" width="80" height="80"><path d="M298 771.3h89.7v44.8H298zM477.3 771.3H567v44.8h-89.7z" fill="#206BAB" p-id="2074"></path><path d="M656.7 771.3h89.7v44.8h-89.7z" fill="#206BAB" p-id="2075"></path><path d="M492.3 68.9L93.5 693.6c-21.4 33.5 2.8 77.3 42.5 77.1h774.1c37.4-0.2 63.9-46.5 43.6-77.9L552 68.9c-24-35.8-35.9-35.8-59.7 0z m0 0" fill="#EEAC38" p-id="2076"></path><path d="M136 770.7c-39.7 0.2-63.9-43.6-42.5-77.1L492.3 68.9s8.9-17.3 25.8-14.9l4 716.8H136z m0 0" fill="#F0BB5D" p-id="2077"></path><path d="M581.9 128.6H462.4s34.5-74.1 57.9-74.7c36.2-0.9 61.6 74.7 61.6 74.7z m0 0" fill="#74A2CA" p-id="2078"></path><path d="M402.6 771.3H283V547.1c0-33 26.8-59.8 59.8-59.8s59.8 26.8 59.8 59.8v224.2z m0 0" fill="#206BAB" p-id="2079"></path><path d="M283 711.5h119.6v59.8H283z" fill="#FFFFFF" p-id="2080"></path><path d="M761.3 771.3H641.7V547.1c0-33 26.8-59.8 59.8-59.8s59.8 26.8 59.8 59.8v224.2z m0 0" fill="#206BAB" p-id="2081"></path><path d="M641.7 711.5h119.6v59.8H641.7z" fill="#FFFFFF" p-id="2082"></path><path d="M178.4 771.3h-47.7c-31.5 0-51.1-29.7-42-59.8 11.7-38.7 89.7-151 89.7-151v210.8z m0 0M865.9 771.3h47.7c31.5 0 53.4-32.4 44.2-62.5-11.7-38.7-91.9-152.4-91.9-152.4v214.9z m0 0" fill="#74A2CA" p-id="2083"></path><path d="M626.8 317.6c0-57.8-46.8-104.6-104.6-104.6s-104.6 46.8-104.6 104.6l104.6 59.8 104.6-59.8z m0 0" fill="#FFFFFF" p-id="2084"></path><path d="M298 831h29.9v44.8h29.9V831h29.9v-29.9H298V831z m0 0M746.3 801.2h-89.7V831h29.9v44.8h29.9V831h29.9v-29.8z m0 0M567 801.2h-89.7V831h29.9v44.8h29.9V831H567v-29.8z m0 0M73.8 801.2h29.9v209.2H73.8zM133.6 875.9h29.9v104.6h-29.9zM178.4 801.2h29.9V846h-29.9zM940.6 801.2h29.9v209.2h-29.9zM880.8 875.9h29.9v104.6h-29.9zM836 801.2h29.9V846H836zM487.9 303.6l-21.1-21.1 29.9-29.9 21.1 21.1-29.9 29.9z m0 0M547.7 303.6l-21.1-21.1 29.9-29.9 21.1 21.1-29.9 29.9z m0 0M327.9 905.8h29.9v104.6h-29.9zM507.2 905.8h29.9v104.6h-29.9zM686.6 905.8h29.9v104.6h-29.9z" fill="#1C1C1A" p-id="2085"></path><path d="M447.4 517.2h29.9v29.9h-29.9zM447.4 577h29.9v29.9h-29.9zM447.4 636.8h29.9v29.9h-29.9zM567 577h29.9v29.9H567zM567 636.8h29.9v29.9H567z" fill="#FFFFFF" p-id="2086"></path><path d="M567 517.2h29.9v29.9H567z" fill="#FFFFFF" p-id="2087"></path><path d="M961 698.2L568.2 64.6c-9.9-16-27.1-25.6-46-25.6s-36.1 9.6-46 25.6L83.3 698.2c-10.5 16.9-11 37.4-1.3 54.9 9.7 17.4 27.4 27.8 47.3 27.8H915c19.9 0 37.6-10.4 47.3-27.8 9.7-17.4 9.2-37.9-1.3-54.9zM701.5 502.3c24.7 0 44.8 20.1 44.8 44.8v149.5h-89.7V547.1c0.1-24.7 20.2-44.8 44.9-44.8z m-44.8 224.1h89.7V751h-89.7v-24.6z m59.7-252.5v-31.4h-29.9v31.4c-34.1 6.9-59.8 37.1-59.8 73.2V751H537V386l104.6-59.8v-8.7c0-65.9-53.6-119.6-119.6-119.6s-119.6 53.6-119.6 119.6v8.7L507 386v365h-89.7V547.1c0-36.1-25.7-66.3-59.8-73.2v-31.4h-29.9v31.4c-34.1 6.9-59.8 37.1-59.8 73.2V751h-74.7V577.4l269-433.8H582l269 433.8V751h-74.7V547.1c-0.1-36.1-25.8-66.3-59.9-73.2zM522.2 360.2l-89.3-51c4.3-45.5 42.7-81.2 89.3-81.2 46.6 0 85 35.7 89.3 81.2l-89.3 51zM342.8 502.3c24.7 0 44.8 20.1 44.8 44.8v149.5H298V547.1c0-24.7 20.1-44.8 44.8-44.8zM298 726.4h89.7V751H298v-24.6zM501.5 80.3c4.5-7.3 12-11.5 20.6-11.5s16.1 4.2 20.6 11.5l20.7 33.4h-82.6l20.7-33.4zM108.1 738.6c-4.3-7.8-4.1-17 0.6-24.6l54.8-88.4V751h-34.2c-8.9 0-16.9-4.6-21.2-12.4z m828.1 0c-4.3 7.8-12.3 12.5-21.2 12.5h-34.2V625.6l54.8 88.4c4.7 7.6 5 16.8 0.6 24.6z m0 0" fill="#1C1C1A" p-id="2088"></path></svg>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/13/jvm/JVMgc%E6%94%B6%E9%9B%86%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/13/jvm/JVMgc%E6%94%B6%E9%9B%86%E5%99%A8/" class="post-title-link" itemprop="url">JVMgc收集器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-13 19:49:31" itemprop="dateCreated datePublished" datetime="2020-02-13T19:49:31+08:00">2020-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-14 13:08:13" itemprop="dateModified" datetime="2021-01-14T13:08:13+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="gc选择"><a href="#gc选择" class="headerlink" title="gc选择"></a>gc选择</h3><h3 id="gc收集器"><a href="#gc收集器" class="headerlink" title="gc收集器"></a>gc收集器</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/12/linux/%E3%80%90linux%E7%AC%94%E8%AE%B0%E3%80%91java%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/12/linux/%E3%80%90linux%E7%AC%94%E8%AE%B0%E3%80%91java%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">【linux笔记】java环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-12 14:39:31" itemprop="dateCreated datePublished" datetime="2020-02-12T14:39:31+08:00">2020-02-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-12 23:56:57" itemprop="dateModified" datetime="2021-01-12T23:56:57+08:00">2021-01-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-下载jdk"><a href="#1-下载jdk" class="headerlink" title="1. 下载jdk"></a>1. 下载jdk</h2><p> <strong>wget</strong>    <em>–no-check-certificate –no-cookies –header “Cookie: oraclelicense=accept-securebackup-cookie”</em>    <strong><a target="_blank" rel="noopener" href="http://download.oracle.com/otn-pub/java/jdk/8u191-b12/2787e4a523244c269598db4e85c51e0c/jdk-8u191-linux-x64.tar.gz">http://download.oracle.com/otn-pub/java/jdk/8u191-b12/2787e4a523244c269598db4e85c51e0c/jdk-8u191-linux-x64.tar.gz</a></strong></p>
<p>a1. 其中  <em>–no-cookies –header “Cookie: oraclelicense=accept-securebackup-cookie”</em> 为Oracle网站下载需要cookie才可以下载</p>
<p>a2. 后面的下载地址可能会随着版本的变化而变，如果不可以需要到Oracle官网重新复制下载地址</p>
<h2 id="2-解压-jdk-："><a href="#2-解压-jdk-：" class="headerlink" title="2. 解压 jdk ："></a>2. 解压 jdk ：</h2><p>tar -zvxf jdk-8u191-linux-x64.tar.gz</p>
<h2 id="3-配置环境变量："><a href="#3-配置环境变量：" class="headerlink" title="3. 配置环境变量："></a>3. 配置环境变量：</h2><ol>
<li>vim /etc/profile </li>
<li>在最前面加：<pre><code>export JAVA_HOME=/opt/jdk1.8.0_191  
export JRE_HOME=$&#123;JAVA_HOME&#125;/jre  
export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  
export  PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</code></pre>
</li>
<li>执行profile文件  source /etc/profile  //这样可以使配置不用重启即可立即生效。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/11/java/Redis%E5%A4%87%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/11/java/Redis%E5%A4%87%E8%A6%81/" class="post-title-link" itemprop="url">Redis备要</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-11 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-11T00:00:00+08:00">2020-02-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-18 16:47:53" itemprop="dateModified" datetime="2021-02-18T16:47:53+08:00">2021-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>  书单：<br>  《 Redis的设计与实现》<br>        《Netty、Redis、Zookeeper高并发实战》</p>
</blockquote>
<hr>
<h1 id="1-Redis是什么"><a href="#1-Redis是什么" class="headerlink" title="1. Redis是什么"></a>1. Redis是什么</h1><p>Redis是一个C语言开发的高性能Key-Value数据库。</p>
<hr>
<h1 id="2-Redis的使用场景"><a href="#2-Redis的使用场景" class="headerlink" title="2. Redis的使用场景"></a>2. Redis的使用场景</h1><ul>
<li>缓存</li>
<li>分布式锁</li>
<li>GEO可以支持地理位置搜索</li>
<li>消息订阅<h2 id="2-1缓存"><a href="#2-1缓存" class="headerlink" title="2.1缓存"></a>2.1缓存</h2><h3 id="2-1-1-缓存穿透"><a href="#2-1-1-缓存穿透" class="headerlink" title="2.1.1 缓存穿透"></a>2.1.1 缓存穿透</h3>缓存穿透指的客户端不断的查询一个数据库不存在的值，多次缓存都没有命中，缓存失去了存在的意义，导致DB不断被直接访问，产生很大压力，就是缓存穿透。<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3></li>
</ul>
<ol>
<li>布隆过滤器 -&gt;将不存在的数据在布隆过滤器中做过滤</li>
<li>存储空值-&gt;直接将不存在的数据也进行存储，只不过是空值</li>
</ol>
<p>以上方法虽然可以解决缓存穿透，但是有可能会有数据一致性的问题。</p>
<h3 id="2-1-2-缓存击穿"><a href="#2-1-2-缓存击穿" class="headerlink" title="2.1.2 缓存击穿"></a>2.1.2 缓存击穿</h3><p>热点数据缓存失效后，大量请求并发访问，同时去缓存数据，导致的数据库压力暴增。</p>
<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><h3 id="2-1-3-缓存雪崩"><a href="#2-1-3-缓存雪崩" class="headerlink" title="2.1.3 缓存雪崩"></a>2.1.3 缓存雪崩</h3><p> 大量数据同时过期，然后去缓存的适合，引发大量访问数据库，数据库压力过大甚至down机</p>
<h3 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h3><ol>
<li>随机时间过期</li>
<li>缓存永不过期策略</li>
<li>缓存添加锁机制和重试，保证某一个缓存在同一时刻，只能被一个线程缓存，</li>
<li>对于部分新功能增加的热点缓存，可以在程序启动后主动进行缓存 ，进行数据预热</li>
<li>Redis高可用，（集群,见下面集群篇）</li>
</ol>
<h2 id="2-2-缓存一致性的问题"><a href="#2-2-缓存一致性的问题" class="headerlink" title="2.2 缓存一致性的问题"></a>2.2 缓存一致性的问题</h2><p>注意，无论是先写缓存后写数据库，还是先写数据库后写缓存，都是有问题的，因为读写是并发的，都会出现数据不一致的情况。</p>
<h3 id="1-写后删除"><a href="#1-写后删除" class="headerlink" title="1.  写后删除"></a>1.  写后删除</h3><p>在写入数据库成功后，删除缓存，这样在数据访问的适合，重新缓存，就能获取到最新的数据。这种其实也是有几率失败了，如一个读操作没有命中缓存，然后准备存储空的时候，写操作执行了删除，然后读操作在写缓存的时候就是错误的。</p>
<h3 id="2-延时双删"><a href="#2-延时双删" class="headerlink" title="2. 延时双删"></a>2. 延时双删</h3><p>为了解决上面的问题，可以使用延时双删的策略，一般是 删除缓存-&gt;更新数据-&gt;sleep(n) -&gt;删除缓存的方式解决</p>
<h3 id="3-只写缓存"><a href="#3-只写缓存" class="headerlink" title="3. 只写缓存"></a>3. 只写缓存</h3><p>只写缓存，然后异步更新到mysql类似与mq，msyql之类的刷盘机制，即我们只操作缓存，然后通过异步的方式，去更新数据库</p>
<h3 id="4-借助于canal工具更新"><a href="#4-借助于canal工具更新" class="headerlink" title="4.借助于canal工具更新"></a>4.借助于canal工具更新</h3><p>程序只写入数据库，然后另外的线程监听canal，更新缓存</p>
<blockquote>
<p>这里学习了左耳耗子的博客 <a target="_blank" rel="noopener" href="https://coolshell.cn/articles/17416.html">https://coolshell.cn/articles/17416.html</a></p>
</blockquote>
<hr>
<h2 id="2-2-分布式锁"><a href="#2-2-分布式锁" class="headerlink" title="2.2 分布式锁"></a>2.2 分布式锁</h2><h3 id="分布式锁需要满足的条件："><a href="#分布式锁需要满足的条件：" class="headerlink" title="分布式锁需要满足的条件："></a>分布式锁需要满足的条件：</h3><ol>
<li>存储空间 -&gt; zai </li>
<li>唯一标示</li>
<li>至少两个可变状态<h3 id="分布式锁核心概念"><a href="#分布式锁核心概念" class="headerlink" title="分布式锁核心概念"></a>分布式锁核心概念</h3></li>
<li>加锁</li>
<li>解锁</li>
<li>锁超时<h3 id="2-2-1-Redis分布式锁"><a href="#2-2-1-Redis分布式锁" class="headerlink" title="2.2.1 Redis分布式锁"></a>2.2.1 Redis分布式锁</h3></li>
<li>加锁<br>基于set 命令的NX PX/EX 选项来实现加锁(在2.6之后可以用，2.6之前需要使用lua)<br>NX:不存在才设置<br>PX/EX:超时时间（区别 一个毫秒/一个秒）<br>value: 唯一标示字符串，在解锁的时候使用</li>
<li>解锁<br>需要使用LUA脚本，将加锁时候Value的唯一字符串进行判断，如果相同，则说明是当前锁，<h4 id="redisson实现了基于Redis的分布式锁"><a href="#redisson实现了基于Redis的分布式锁" class="headerlink" title="redisson实现了基于Redis的分布式锁"></a>redisson实现了基于Redis的分布式锁</h4></li>
</ol>
<h3 id="2-2-2-ZK实现的分布式锁"><a href="#2-2-2-ZK实现的分布式锁" class="headerlink" title="2.2.2 ZK实现的分布式锁"></a>2.2.2 ZK实现的分布式锁</h3><ul>
<li><p>最基本的是利用ZK节点不能重复的特性，来实现分布式锁，但是这样可能产生惊群效应</p>
</li>
<li><p>ZK中还有一种名为临时节点的节点，临时节点由某个客户端创建，当客户端与ZK集群断开连接，则该节点自动被删除。EPHEMERAL_SEQUENTIAL为临时顺序节点。</p>
</li>
<li><p>ZK临时顺序节点是天然的发号器</p>
</li>
<li><p>ZK的递增节点可以保证锁的公平性</p>
</li>
<li><p>ZK的节点监听可以保证节点的锁的传递</p>
</li>
<li><p>ZK的节点监听可以避免惊群效应</p>
</li>
</ul>
<h4 id="加锁过程"><a href="#加锁过程" class="headerlink" title="加锁过程"></a>加锁过程</h4><ol>
<li>在一个永久节点下面创建一个临时节点，然后判断自己是否是最小的那个节点，如果不是，就监听前一个节点</li>
<li>如果监听到前一个节点释放，就判断自己是否是最小的那个节点，如果是则加锁成功，否则持续监听，</li>
<li>完成后删除自己的节点，进行锁释放工作</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>性能不高</p>
<h5 id="Menagerie-实现了基于ZK的分布式锁"><a href="#Menagerie-实现了基于ZK的分布式锁" class="headerlink" title="Menagerie 实现了基于ZK的分布式锁"></a>Menagerie 实现了基于ZK的分布式锁</h5><h3 id="分布式锁选择"><a href="#分布式锁选择" class="headerlink" title="分布式锁选择"></a>分布式锁选择</h3><blockquote>
<p>并发高，性能要求高redis ,高可靠，高可用，公平，ZK</p>
</blockquote>
<ul>
<li>基于Redis的分布式锁。适用于并发量很大、性能要求很高而可靠性问题可以通过其他方案去弥补的场景。</li>
<li>基于ZooKeeper的分布式锁。适用于高可靠（高可用），而并发量不是太高的场景。</li>
</ul>
<hr>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>Redis服务器默认会创建16个数据库，自定义是由 db num属性决定的</p>
<h2 id="数据库键空间"><a href="#数据库键空间" class="headerlink" title="数据库键空间"></a>数据库键空间</h2><ul>
<li>dict字典保存了数据库中的所有键值对，我们将这个字典称为键空间（key space）</li>
<li>在读取一个键之后，服务器会更新键的LRU（最后一次使用）时间，这个值可以用于计算键的闲置时间，使用OBJECT idletime命令可以查看键key的闲置时间。</li>
<li>在读取一个键之后（读操作和写操作都要对键进行读取），服务器会根据键是否存在来更新服务器的键空间命中（hit）次数或键空间不命中（miss）次数，这两个值可以在INFO stats命令的keyspace_hits属性和keyspace_misses属性中查看。</li>
</ul>
<h2 id="key的过期时间"><a href="#key的过期时间" class="headerlink" title="key的过期时间"></a>key的过期时间</h2><ul>
<li>redisDb结构的expires字典保存了数据库中所有键的过期时间，我们称这个字典为过期字典</li>
<li>过期字典的键是一个指针，这个指针指向键空间中的某个键对象（也即是某个数据库键）</li>
<li>过期字典的值是一个long 类型的整数，这个整数保存了键所指向的数据库键的过期时间——一个毫秒精度的UNIX时间戳。<h3 id="过期键的判定"><a href="#过期键的判定" class="headerlink" title="过期键的判定"></a>过期键的判定</h3>1）检查给定键是否存在于过期字典：如果存在，那么取得键的过期时间。2）检查当前UNIX时间戳是否大于键的过期时间：如果是的话，那么键已经过期；否则的话，键未过期。<h3 id="过期键的删除策略"><a href="#过期键的删除策略" class="headerlink" title="过期键的删除策略"></a>过期键的删除策略</h3></li>
<li>定时删除：在设置键的过期时间的同时，创建一个定时器（timer），让定时器在键的过期时间来临时，立即执行对键的删除操作。对内存是友好的，可以保证键被尽快删除，但是如果过多键同时到期，对cpu极度不友好，影响服务器的响应时间。</li>
<li>惰性删除：放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键；如果没有过期，就返回该键。对内存不友好，可能造成内存中存在很多过期的数据，有内存泄漏的危险。但是对cpu是友好的，因为只有在用的时候才回去清楚。</li>
<li>定期删除：每隔一段时间，程序就对数据库进行一次检查，删除里面的过期键。至于要删除多少过期键，以及要检查多少个数据库，则由算法决定。</li>
</ul>
<h3 id="AOF和RDB对过期的处理"><a href="#AOF和RDB对过期的处理" class="headerlink" title="AOF和RDB对过期的处理"></a>AOF和RDB对过期的处理</h3><ul>
<li>AOF: 在键没有被删除的时候是没有任何影响的，删除的键会产生一个DEL语句，在AOF重写的过程中，会把DEL的语句优化掉。</li>
<li>RDB: 过期的键不会载入RDB文件，从RDB文件加载的时候，过期的键也不会加载到内存<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3>当服务器运行在复制模式下时，从服务器的过期键删除动作由主服务器控制，从服务器不会去主动删除。当主服务器删除一个过期键之后，它会向所有从服务器发送一条DEL命令，显式地删除过期键</li>
</ul>
<hr>
<h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><ul>
<li>服务器中的非空数据库以及它们的键值对统称为数据库状态。</li>
<li>RDB将Redis在内存中的数据库状态保存到磁盘里面，避免数据意外丢失。</li>
<li>RDB可以手动执行也可以自动执行</li>
<li>SAVE命令 和 BGSAVE命令都可以生产RDB文件。</li>
<li>SAVE命令会阻塞Redis服务器进程，直到RDB文件创建完毕为止，在服务器进程阻塞期间，服务器不能处理任何命令请求：</li>
<li>BGSAVE命令会派生出一个子进程，然后由子进程负责创建RDB文件，服务器进程（父进程）继续处理命令请求：</li>
<li>如果开启AOF,则默认使用AOF,因为AOF更新频率更高<br><img src="https://upload-images.jianshu.io/upload_images/13349286-1071625264fa0153.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="数据库恢复"></li>
<li>服务器在载入RDB文件期间，会一直处于阻塞状态，直到载入工作完成为止。</li>
<li>自动间隔性保存：服务器状态中会保存所有用save选项设置的保存条件，当任意一个保存条件被满足时，服务器会自动执行BGSAVE命令。包括像多少时间进行了多少次修改，</li>
<li>Redis的服务器周期性操作函数serverCron默认每隔100毫秒就会执行一次，该函数用于对正在运行的服务器进行维护，它的其中一项工作就是检查save选项所设置的保存条件是否已经满足，如果满足的话，就执行BGSAVE命令。</li>
<li>对于不同类型的键值对，RDB文件会使用不同的方式来保存它们。</li>
</ul>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><ul>
<li>AOF持久化是通过保存Redis服务器所执行的写命令来记录数据库状态的</li>
<li>AOF写入时机：每次在结束文件事件前，都会考虑是否把新内容添加到AOF缓冲区中，AOF缓冲区有三种方式刷盘，1 每次刷盘 2. 每隔1s刷 3. 等缓冲区满后刷新</li>
<li>AOF文件的读取，创建伪客户端，由伪客户端一条一条的执行AOF日志，直到执行完毕</li>
</ul>
<h3 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h3><ul>
<li>重写是在子进程中完成</li>
<li>重写和原AOF文件无关，根据数据库当前状态，生成一份新的AOF文件</li>
<li>在重写的过程中，会维持一个重写缓冲区，在重写过程中执行的命令都是在缓冲区进行记录，在重写完成后追加到新文件结尾，然后替换旧的文件，完成一个重写。</li>
</ul>
<hr>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p>Redis服务器是一个事件驱动程序，服务器需要处理文件事件和事件事件</p>
<h2 id="文件事件"><a href="#文件事件" class="headerlink" title="文件事件"></a>文件事件</h2><ul>
<li>文件事件处理器是基于Reactor模式实现的网络通信程序。</li>
<li>文件事件处理器使用I/O多路复用（multiplexing）程序来同时监听多个套接字，并根据套接字目前执行的任务来为套接字关联不同的事件处理器。</li>
<li>当被监听的套接字准备好执行连接应答（accept）、读取（read）、写入（write）、关闭（close）等操作时，与操作相对应的文件事件就会产生，这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。<br><img src="https://upload-images.jianshu.io/upload_images/13349286-8b39131c2f6ea462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="处理过程"></li>
<li>当多个IO事件发生的时候，IO复用程序会将所有的套接字放在一个队列中，以有序，同步，一个一个的处理套接字。当上一个处理完成之后，才会去处理下一个套接字，这也就是为什么总有人说Redis是单线程的原因。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-6d323150658f06c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="事件处理队列"></p>
<h2 id="时间事件"><a href="#时间事件" class="headerlink" title="时间事件"></a>时间事件</h2><ul>
<li>服务器在一般情况下只执行serverCron函数一个时间事件，并且这个事件是周期性事件。</li>
</ul>
<h2 id="事件的调度与执行"><a href="#事件的调度与执行" class="headerlink" title="事件的调度与执行"></a>事件的调度与执行</h2><ul>
<li>文件事件和时间事件之间是合作关系，服务器会轮流处理这两种事件，并且处理事件的过程中也不会进行抢占。</li>
<li>时间事件的实际处理时间通常会比设定的到达时间晚一些。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-ff359fcdfa5b4b10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="事件的调度"></p>
<h1 id="serverCron函数"><a href="#serverCron函数" class="headerlink" title="serverCron函数"></a>serverCron函数</h1><p>Redis服务器中的serverCron函数默认每隔100毫秒执行一次，这个函数负责管理服务器的资源，并保持服务器自身的良好运转。</p>
<h3 id="更新服务器时间缓存"><a href="#更新服务器时间缓存" class="headerlink" title="更新服务器时间缓存"></a>更新服务器时间缓存</h3><ul>
<li>在精度要求不高的情况下，如果需要获得时间信息，Redis是直接从缓存获取，一般包括日志，是否持久化等情况下<h3 id="更新LRU时间信息"><a href="#更新LRU时间信息" class="headerlink" title="更新LRU时间信息"></a>更新LRU时间信息</h3></li>
<li>每个Redis对象都会有一个lru属性，这个lru属性保存了对象最后一次被命令访问的时间</li>
</ul>
<hr>
<h1 id="Redis的淘汰策略"><a href="#Redis的淘汰策略" class="headerlink" title="Redis的淘汰策略"></a>Redis的淘汰策略</h1><ul>
<li>从已经设置过期时间的key中挑选最近最少使用的</li>
<li>从已经设置过期时间的key中最快过期的</li>
<li>从已经设置过期时间的key随机淘汰</li>
<li>从整个数据选择最近最少使用</li>
<li>从整个数据随机淘汰</li>
<li>不淘汰</li>
</ul>
<hr>
<h1 id="Redis高可用"><a href="#Redis高可用" class="headerlink" title="Redis高可用"></a>Redis高可用</h1><h2 id="1-复制"><a href="#1-复制" class="headerlink" title="1.  复制"></a>1.  复制</h2><ul>
<li> 基于RDB实现初始化，也就是同步操作，使用AOF实现同步复制，也就是命令传播</li>
<li>缺点：不支持自动扩容，没有高可用，可能产生数据不一致的问题<h3 id="旧版复制功能"><a href="#旧版复制功能" class="headerlink" title="旧版复制功能"></a>旧版复制功能</h3><h4 id="同步操作-SYNC命令"><a href="#同步操作-SYNC命令" class="headerlink" title="同步操作 - SYNC命令"></a>同步操作 - SYNC命令</h4><img src="https://upload-images.jianshu.io/upload_images/13349286-dc2a345e872321ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="复制过程"><h4 id="复制的时机"><a href="#复制的时机" class="headerlink" title="复制的时机"></a>复制的时机</h4></li>
<li>从初次连接同步主的内容</li>
<li>从断线之后，再次去同步主的内容<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4></li>
<li>同步十分低效，耗费大量的资源</li>
<li>在断线重联的情况下，大部分数据是相同的，但是还是要执行全量同步<h4 id="命令传播"><a href="#命令传播" class="headerlink" title="命令传播"></a>命令传播</h4>在同步操作完成后，暂时主从一致，但是如果主一旦发生写操作，主会将写操作命令发送给从，从服务其执行后，再次回到一致的状态<h3 id="新版复制功能"><a href="#新版复制功能" class="headerlink" title="新版复制功能"></a>新版复制功能</h3><h4 id="PSYNC命令"><a href="#PSYNC命令" class="headerlink" title="PSYNC命令"></a>PSYNC命令</h4></li>
<li>在初次同步相同，但是断线重联的时候，只会发送在断线期间执行的写操作，而不是全量同步</li>
<li>主从维持着一个复制的偏移量，通过偏移量，很容易就知道主从是否一致</li>
<li>在主发送写操作的时候，同时会将写操作保存在一个固定队列中，这样，如果重联只会的偏移量在队列中，就可以迅速使用队列中的命令进行恢复</li>
</ul>
<h3 id="心跳检测"><a href="#心跳检测" class="headerlink" title="心跳检测"></a>心跳检测</h3><p>在命令传播的阶段，从服务器会每秒1次向主服务器发送心跳请求<br>用来：</p>
<ul>
<li>检测主从服务器的网络连接状态</li>
<li>辅助实现min-slaves配置选项，主服务会检测从服务器最少多少个，延迟多少的时候才写入数据。</li>
<li>检测命令丢失<h2 id="2-哨兵"><a href="#2-哨兵" class="headerlink" title="2. 哨兵"></a>2. 哨兵</h2>基于主从复制，可以自动实现切换主从结构</li>
<li>哨兵由一个或者多个组成哨兵集群</li>
<li>哨兵检测主从所有的节点</li>
<li>当主节点挂掉的时候，哨兵会从其中一个从节点挑选一个作为主节点，当挂掉的主节点从新上线后，会降级当前主节点的从节点。<h2 id="3-Cluster"><a href="#3-Cluster" class="headerlink" title="3. Cluster"></a>3. Cluster</h2></li>
<li>实际上辅助和哨兵至是实现了Redis的高可用，但是其每一个机器都是存储完整数据，资源浪费很严重</li>
<li>节点通过握手来将其他节点添加到自己所处的集群当中。</li>
<li>集群的整个数据库被分为16384个槽（slot），数据库中的每个键都属于这16384个槽的其中一个，集群中的每个节点可以处理0个或最多16384个槽。</li>
<li>集群中的16384个槽可以分别指派给集群中的各个节点，每个节点都会记录哪些槽指派给了自己，而哪些槽又被指派给了其他节点。</li>
<li>在Cluster执行lua脚本的时候，会有一定的问题，因为Redis要求执行lua的脚本都在一个节点上面，如果你的lua脚本包含多个节点，就会报错，解决方法是在key中增加{}，如果key中包含{}, 就会使用第一个{}内部的字符串作为hash key，这样就可以保证拥有同样{}内部字符串的key就会拥有相同slot。</li>
<li>节点在接到一个命令请求时，会先检查这个命令请求要处理的键所在的槽是否由自己负责，如果不是的话，节点将向客户端返回一个MOVED错误，MOVED错误携带的信息可以指引客户端转向至正在负责相关槽的节点。</li>
<li>使用了跳跃表来保存槽和键之间的关系</li>
<li>重新分片： 将节点A的槽数据至节点B，Redis使用了redis-trib来实现。<ul>
<li>过程：1. 通知A做好准备，2，通知B做好准备 3，获取n个键值 4，发送migrate命令，将选中的进行迁移 5，重复直到复制完成 6，将指派信息通知集群。</li>
</ul>
</li>
<li>ask错误：如果节点A正在迁移槽i至节点B，那么当节点A没能在自己的数据库中找到命令指定的数据库键时，节点A会向客户端返回一个ASK错误，指引客户端到节点B继续查找指定的数据库键。</li>
<li>  Redis集群中的节点分为主节点（master）和从节点（slave），其中主节点用于处理槽，而从节点则用于复制某个主节点，并在被复制的主节点下线时，代替下线主节点继续处理命令请求。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/10/java/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/10/java/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">领域驱动设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-10T00:00:00+08:00">2020-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-30 12:54:28" itemprop="dateModified" datetime="2021-05-30T12:54:28+08:00">2021-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><blockquote>
<p><strong>学习DDD看的书</strong></p>
<ol>
<li>《实现领域驱动设计》<br> 基础只是,概念</li>
<li>《领域驱动设计：软件核心复杂性应对之道 》<br> 使用,流程,串联<br>千万不要先看 《领域驱动设计：软件核心复杂性应对之道 》，不然你会哭的，因为你看的和天书基本没啥区别，要先看 《实现领域驱动设计》，然后在去看 埃文斯的那本书。</li>
</ol>
</blockquote>
<h3 id="领域模型"><a href="#领域模型" class="headerlink" title="领域模型"></a>领域模型</h3><p>领域模型是某个业务领域的软件模型，通常通过对象模型来实现。</p>
<h3 id="贫血模型和充血模型"><a href="#贫血模型和充血模型" class="headerlink" title="贫血模型和充血模型"></a>贫血模型和充血模型</h3><ul>
<li>在贫血模型中，对象中只有属性值和公有的get set 方法，几乎没有业务逻辑，完全就是一个数据集。</li>
<li>在充血模型中，数据与对应的业务逻辑被封装在一个类中，这种模型满足面向对象的封装特性，是典型的面向对象编程。</li>
<li>充血模型和贫血模型是领域对象和非领域对象的重要区别。<h3 id="失忆症"><a href="#失忆症" class="headerlink" title="失忆症"></a>失忆症</h3></li>
<li>当业务逻辑出现多次变化的适合，直接散落在项目中的各个业务逻辑很可能忘记其本来的意图，而业务的迭代，可能会导致项目越来越复杂，这样就会出现，除作者以外，甚至作者，看这段代码的适合会蒙圈，这种一般称为贫血模型导致的失忆症。<h3 id="是充血模型的好处"><a href="#是充血模型的好处" class="headerlink" title="是充血模型的好处"></a>是充血模型的好处</h3></li>
<li>复用程度高，表达能力强，适合复杂的业务逻辑处理</li>
<li>业务逻辑的变动，很可能会导致领域模型的变动，但是，这个在传统的开发中也是不可避免的，但是充血模型将逻辑高内聚，反而不容易漏改逻辑<h3 id="举例-–-这个可以不看"><a href="#举例-–-这个可以不看" class="headerlink" title="举例 – 这个可以不看"></a>举例 – 这个可以不看</h3>一个简单的主子订单模型，加上付款操作<br>在传统模式下，可见我们的对象只是一个数据集合，除了传递数据，并没有做任何操作，这个只是一个简单的付款，如果之后，业务场景复杂后，很可能出现，这个一个业务逻辑，哪里一个业务逻辑<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">public class Order &#123;</span><br><span class="line">    private Long orderId;</span><br><span class="line">    private String orderNo;</span><br><span class="line">    private Long amount;</span><br><span class="line">    private Integer status;</span><br><span class="line">    ---get set 方法 --- </span><br><span class="line">&#125;</span><br><span class="line">public class OrderItem &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private Long orderId;</span><br><span class="line">    private Long orderNo;</span><br><span class="line">    private String itemName;</span><br><span class="line">    private Long payAmount；</span><br><span class="line">  --- get set 方法--- </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">付款方法</span><br><span class="line">    public void pay(OrderReq orderReq)&#123;</span><br><span class="line">        Order order &#x3D;  dao1.query(orderReq);</span><br><span class="line">        List&lt;OrderItem&gt;  orderItems &#x3D; dao2.query(orderReq);</span><br><span class="line">        ---业务逻辑</span><br><span class="line">        order.setStatus(PAY);</span><br><span class="line">        for (OrderItem orderItem : orderItems) &#123;</span><br><span class="line">           ----业务逻辑</span><br><span class="line">            orderItem.setPayAmount(orderReq.getPayAmount());</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.execute()&#123;</span><br><span class="line">            dao1.save(order);</span><br><span class="line">            dao2.save(orderItems);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">业务更新后，很可能 </span><br><span class="line">    public void pay(OrderReq orderReq)&#123;</span><br><span class="line">        Order order &#x3D;  dao1.query(orderReq);</span><br><span class="line">        List&lt;OrderItem&gt;  orderItems &#x3D; dao2.query(orderReq);</span><br><span class="line">        ---业务逻辑</span><br><span class="line">         order.setStatus(PAY);</span><br><span class="line">        if(会员)&#123;</span><br><span class="line">          order.setStatus(PAY1);</span><br><span class="line">        &#125;</span><br><span class="line">        if(优惠)&#123;</span><br><span class="line">         order.setStatus(PAY2);</span><br><span class="line">        &#125;</span><br><span class="line">        for (OrderItem orderItem : orderItems) &#123;</span><br><span class="line">           ----业务逻辑</span><br><span class="line">        if(优惠)&#123;</span><br><span class="line">         orderItem.setStatus(PAY2);</span><br><span class="line">        &#125;</span><br><span class="line">        if(会员)&#123;</span><br><span class="line">          orderItem.setStatus(PAY1);</span><br><span class="line">        &#125;</span><br><span class="line">            orderItem.setPayAmount(orderReq.getPayAmount());</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.execute()&#123;</span><br><span class="line">            dao1.save(order);</span><br><span class="line">            dao2.save(orderItems);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="领域是什么"><a href="#领域是什么" class="headerlink" title="领域是什么"></a>领域是什么</h3>在实现领域驱动一书中这样解释<blockquote>
<p>从广义上讲，领域（Domain）即是一个组织所做的事情以及其中所包含的一切。商业机构通常会确定一个市场，然后在这个市场中销售产品和服务。每个组织都有它自己的业务范围和做事方式。这个业务范围以及在其中所进行的活动便是领域。当你为某个组织开发软件时，你面对的便是这个组织的领域。这个领域对于你来说应该是明晰的，因为你在这个领域中工作。</p>
</blockquote>
</li>
</ul>
<p>在我看来，领域其实就是我们的业务模块，或者说是我们的实际业务就是领域。</p>
<h3 id="子域"><a href="#子域" class="headerlink" title="子域"></a>子域</h3><p>对一个大的领域的问题进行根据业务职能的划分，例如在一个电商项目中，商品，订单，支付，履约，结算，库存，物流，发票，用户就是不同的子域。而在子域的划分中，也会产生不同的类型，<strong>核心子域</strong>，<strong>通用子域</strong>，<strong>支撑子域</strong>等等。</p>
<h3 id="限界上下文"><a href="#限界上下文" class="headerlink" title="限界上下文"></a>限界上下文</h3><ul>
<li>特定模型的限界应用。限界上下文使团队所有成员能够明确地知道什么必须保持一致，什么必须独立开发。</li>
<li>限界上下文为业务流程在一个划定的界限，由一个或者多个子域组成。</li>
<li>在基于某一个角度，将多个子域划分进一个限界上下文</li>
<li>限界上下文即是一个特定的解决方案，在一个特定的限界上下文只使用一套通用语言，并且保证它的清晰性和简洁性。</li>
</ul>
<h3 id="问题空间和解决问题空间"><a href="#问题空间和解决问题空间" class="headerlink" title="问题空间和解决问题空间"></a>问题空间和解决问题空间</h3><ul>
<li> 问题空间：是我们业务所遇到的挑战，问题空间是领域的一部分，对问题空间的开发将产生一个新的核心域，问题空间是核心域和其他子域的组合。</li>
<li> 解决问题空间：如何实现软件以解决这些业务挑战，包括一个或多个限界上下文，即一组特定的软件模型来解决问题。</li>
</ul>
<h3 id="上下文映射图"><a href="#上下文映射图" class="headerlink" title="上下文映射图"></a>上下文映射图</h3><ul>
<li>表示限界上下文和他们呢的集成关系，下面就是一个上下文映射图，<br><img src="https://upload-images.jianshu.io/upload_images/13349286-c5a36a8bffce5667.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="U表示上游（Upstream），D表示下游（Downstream）"></li>
</ul>
<h2 id="领域驱动架构"><a href="#领域驱动架构" class="headerlink" title="领域驱动架构"></a>领域驱动架构</h2><h3 id="系统分层"><a href="#系统分层" class="headerlink" title="系统分层"></a>系统分层</h3><p><img src="https://upload-images.jianshu.io/upload_images/13349286-bee4108b66c4303a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DDD所使用的传统分层架构"></p>
<ul>
<li>一般我们使用聚合或者工厂对复杂的聚合进行创建，而不是直接在应用层创建</li>
<li>领域模型用于发布领域事件时，应用层可以将订阅方注册到任意数量的事件上，这样的好处是可以对事件进行存储和转发。同时，领域模型只需要关注自己的核心逻辑；领域事件发布器也可以保持轻量化，而不用依赖于消息机制的基础设施，可以使用Spring的event事件。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-3b7db3017cb2ef78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="命令和查询职责分离——CQRS"><a href="#命令和查询职责分离——CQRS" class="headerlink" title="命令和查询职责分离——CQRS"></a>命令和查询职责分离——CQRS</h3><ol>
<li>如果一个方法修改了对象的状态，该方法便是一个命令（Command），它不应该返回数据。在Java和C#中，这样的方法应该声明为void。</li>
<li>如果一个方法返回了数据，该方法便是一个查询（Query），此时它不应该通过直接的或间接的手段修改对象的状态。在Java和C#中，这样的方法应该以其返回的数据类型进行声明。</li>
</ol>
<h3 id="防腐层"><a href="#防腐层" class="headerlink" title="防腐层"></a>防腐层</h3><ul>
<li>当你的领域和其他领域存在数据交互时，你需要一个防腐层作为两个领域之间的纽带。这会给你带来很多“数据转换”的代码，但是对于业务多变的系统来讲，它能保护你的领域。</li>
<li>在我们的微服务架构中，一般来说指当前服务与其他服务进行交互的适合，并不直接调用，而由一个中间层，来进行判断，处理，缓冲。</li>
</ul>
<h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><ul>
<li>一种对象，它不是由属性来定义的，而是通过一连串的连续事件和标识定义的。</li>
<li>实体应该具有唯一标示，如订单号，身份证号，用户id</li>
<li>唯一标示可以有用户产生(如手机号)/系统产生（如uuid）/持久化机制生成（如mysql主键）</li>
<li>实体的其他信息可以进行修改，但是无论如何修改，唯一标示是不变的，其还是一个相同的实体。</li>
</ul>
<h3 id="值对象"><a href="#值对象" class="headerlink" title="值对象"></a>值对象</h3><ul>
<li>一种描述了某种特征或属性但没有概念标识的对象。</li>
<li><strong>度量或描述</strong>,它度量或者描述了领域中的一件东西。</li>
<li><strong>不变性</strong>,可以作为不变量，一个值对象创建了就不能改变了</li>
<li><strong>概念整体</strong>，它将不同的相关的属性组合成一个概念整体。一个值对象可以只处理单个属性，也可以处理一组相关联的属性。在这组相关联的属性中，每一个属性都是整体属性所不可或缺的组成部分，这和简单地将一组属性组装在对象中是不同的。如果一组属性联合起来并不能表达一个整体上的概念，那么这种联合并无多大用处。<br>即他可以是单个属性，也可以是多个属性，但必须是有关联性的，而不是一堆属性的聚合。</li>
<li><strong>可替换性</strong>，当度量和描述改变时，可以用另一个值对象予以替换。</li>
<li><strong>值对象相等性</strong>，它可以和其他值对象进行相等性比较</li>
<li><strong>无副作用行为</strong>，它不会对协作对象造成副作用<h4 id="最小化集成"><a href="#最小化集成" class="headerlink" title="最小化集成"></a>最小化集成</h4>在所有的DDD项目中，通常存在多个限界上下文，这意味着我们需要找到合适的方法对这些上下文进行集成。当模型概念从上游上下文流入下游上下文中时，尽量使用值对象来表示这些概念。这样的好处是可以达到最小化集成，即可以最小化下游模型中用于管理职责的属性数目。使用不变的值对象使得我们做更少的职责假设。</li>
</ul>
<p>这里我理解的最小化集成，就是我们的限界上下文直接的参数应该是值对象</p>
<h3 id="领域服务"><a href="#领域服务" class="headerlink" title="领域服务"></a>领域服务</h3><ul>
<li>领域中的服务表示一个无状态的操作，它用于实现特定于某个领域的任务</li>
<li>慎重使用领域服务，能在聚合和实体中完成的操作，不要放在领域服务中，过度使用领域服务将会造成贫血领域模型。</li>
<li>领域服务通常和领域内相关的聚合放在同一模块（目录）下。</li>
</ul>
<p><strong>什么是领域服务</strong></p>
<ol>
<li>执行一个显著的业务操作过程。</li>
<li>对领域对象进行转换。</li>
<li>以多个领域对象作为输入进行计算，结果产生一个值对象。</li>
</ol>
<h3 id="领域事件-Domain-Event"><a href="#领域事件-Domain-Event" class="headerlink" title="领域事件 Domain Event"></a>领域事件 Domain Event</h3><ul>
<li>领域事件用于发布和捕捉发生在领域内的一些事情，领域事件通常是由某个聚合发出，在整个领域范围内订阅。某某方法执行完成、某某数据修改成功、某某接口调用结束等等都可以理解为领域内事件，这些事件结束后我们往往需要做一些进一步的操作，比如：订单领域完成下单操作后，物流领域需要开始物流。这是在两个领域之间具备先后关系的事件，问题在于完成下单之后怎么通知物流领域呢？直接调用吗？领域事件认为，在有需要时，当订单创建完成，应当对外发布一个携带了必要对象信息的订单创建完成事件（OrderCreatedEvent）消息，由订阅方订阅到该事件消息，进而完成后续业务。</li>
<li>领域事件是对领域内发生的活动进行的建模</li>
<li>我觉的领域事件就使用事务消息就比较好，别的书里说的感觉用处不大</li>
</ul>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><ul>
<li>可以理解为 package分包</li>
<li>模块表示了一个命名的容器，用于存放领域中内聚在一起的类。</li>
<li>将类放在不同模块中的目的在于达到松耦合性。</li>
<li>由于DDD中的模块并不是一个通用的存储区域，因此对其进行适当的命名是重要的。</li>
<li>事实上，模块名是通用语言的重要组成部分。</li>
<li>模块应该包含一组具有高内聚性的概念集合，这样做的好处是可以在不同的模块之间实现松耦合</li>
</ul>
<p><strong>模块的命名规范</strong></p>
<ul>
<li> 通常模块名就是包名，一般来说是公司层面统一的</li>
<li> 先考虑模块，再是限界上下文，因为模块的目的在于组织那些内聚在一起的领域对象<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3></li>
<li>将实体和值对象在一致性边界之内组成聚合（Aggregate）</li>
<li>聚合就是一组相关对象的集合，我们把聚合作为数据修改的单元。外部对象只能引用聚合中的一个成员，我们把它称为根。在聚合的边界之内应用一组一致的规则。</li>
</ul>
<p><strong>聚合的原则</strong></p>
<ol>
<li>在一致性边界之内建模真正的不变条件:<br>不变条件是指某个业务规则，这个规则应该总是保持一致的。这里的一致通常是指事务一致性，因为聚合作为我们操作和读取数据的基本单元，这就要求我们在提交事务时，该聚合边界内的所有对象都应当保持一致。  <strong>即在一个事务中只修改一个聚合实例，需要保证事务一致性</strong></li>
<li>设计小聚合<br>因为聚合需要保证在一个事务中只能修改一个聚合，所以聚合需要更加紧凑，逻辑更加一致，保证在单个聚合的事务一致性，多个聚合直接，需要实现最终一致性。</li>
<li>通过唯一标识引用其他聚合<br>即聚合直接引用的适合使用唯一标示引用，而不是直接引用聚合对象。在java中，通俗标示，就是我们因为另一个聚合的唯一id，而不是直接引用对象，这样我们的聚合会更加轻量级，减少内存，对与java来说，对gc也有好处。</li>
<li>在边界之外使用最终一致性<br>即多个聚合直接需要保持最终一致性，一般使用事件驱动来完成最终一致性</li>
</ol>
<h3 id="工厂-Factory"><a href="#工厂-Factory" class="headerlink" title="工厂 Factory"></a>工厂 Factory</h3><ul>
<li>将创建复杂对象和聚合的职责分配给一个单独的对象，该对象本身并不承担领域模型中的职责，但是依然是领域设计的一部分。工厂应该提供一个创建对象的接口，该接口封装了所有创建对象的复杂操作过程，同时，它并不需要客户去引用那个实际被创建的对象。对于聚合来说，我们应该一次性地创建整个聚合，并且确保它的不变条件得到满足</li>
<li>隐藏创建细节，方便调用</li>
</ul>
<h3 id="资源库-Repository"><a href="#资源库-Repository" class="headerlink" title="资源库 Repository"></a>资源库 Repository</h3><ul>
<li>我理解的在我们的开发过程中，资源库就是我们的dao层，与数据存储进行交互的。一般资源库分为<strong>面向集合的资源库</strong>和<strong>面向持久化的资源库</strong></li>
</ul>
<ol>
<li>面向集合的资源库</li>
</ol>
<p>面向集合的资源库是指资源库就像一个集合，在向一个Set集合中添加聚合时，如果重复添加是不会成功的，从集合中获取到的实例也可以直接进行修改而不需要写会操作，因为从集合中获取到的对象是引用类型，这意味着任何修改都会直接生效。类似Hibernate,但是用的不多</p>
<ol start="2">
<li>面向持久化的资源库</li>
</ol>
<p>面向持久化的资源库就是我们熟悉的数据库操作，但是我们需要把实现细节进行封装，资源库应该尽可能地模拟一个集合的操作方式，将细节封装，例如防止聚合添加重复的校验不再由客户端做，调用方不关心细节，可以完全作为一个集合的方式使用。</p>
<p><strong>还有</strong></p>
<ul>
<li>对事务的管理绝对不应该放在领域模型和领域层中，而应该放在应用层<h4 id="资源库和dao的区别"><a href="#资源库和dao的区别" class="headerlink" title="资源库和dao的区别"></a>资源库和dao的区别</h4></li>
<li>DAO主要从数据库表的角度来看待问题，并且提供CRUD操作，DAO相关的模式通常只是对数据库表的一层封装。</li>
<li>而资源库采用面向集合的方式，而不是面向数据访问的方式。</li>
<li>所以 资源库 可以看作 DAO，但是DAO不一定是资源库</li>
</ul>
<h3 id="基础设施"><a href="#基础设施" class="headerlink" title="基础设施"></a>基础设施</h3><p>基础设施的职责是为应用程序的其他部分提供技术支持。</p>
<h3 id="集成限界上下文"><a href="#集成限界上下文" class="headerlink" title="集成限界上下文"></a>集成限界上下文</h3><ul>
<li>常见的手段包括开放领域服务接口、开放HTTP服务以及消息发布-订阅机制。</li>
</ul>
<h2 id="领域对象的生命周期"><a href="#领域对象的生命周期" class="headerlink" title="领域对象的生命周期"></a>领域对象的生命周期</h2><p><img src="https://upload-images.jianshu.io/upload_images/13349286-e79f38f921de9fb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol>
<li>使用FACTORY（工厂）来创建和重建复杂对象和AGGREGATE（聚合），从而封装它们的内部结构。</li>
<li>在生命周期的中间和末尾使用REPOSITORY（存储库）来提供查找和检索持久化对象并封装庞大基础设施的手段。</li>
</ol>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350033901">https://zhuanlan.zhihu.com/p/350033901</a><br><a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/12/22/ddd-in-practice.html">https://tech.meituan.com/2017/12/22/ddd-in-practice.html</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/10/other/maven%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/10/other/maven%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">maven插件的开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-10T00:00:00+08:00">2020-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-11 11:53:36" itemprop="dateModified" datetime="2021-03-11T11:53:36+08:00">2021-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">maven插件的开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如果你想要了解某个事物，你必须要成为其中的一员。想要理解maven插件，我们就尝试来开发一个maven插件</p>
<p>官方文档位置：<a target="_blank" rel="noopener" href="http://maven.apache.org/guides/introduction/introduction-to-plugins.html">http://maven.apache.org/guides/introduction/introduction-to-plugins.html</a></p>
<h2 id="什么是mavne插件"><a href="#什么是mavne插件" class="headerlink" title="什么是mavne插件"></a>什么是mavne插件</h2><p>Maven 实际上是一个依赖插件执行的框架，每个任务实际上是由插件完成。换句话说，插件是执行大部分实际操作的地方，插件用来：创建jar文件，创建war文件，编译代码，单元测试代码，创建项目文档等等操作。您可以想到在项目上执行的几乎所有操作均作为Maven插件实现。</p>
<p>插件是Maven的核心功能，它允许在多个项目中重用通用的构建逻辑。他们通过在项目pom文件的上下文中执行“操作”（即创建WAR文件或编译单元测试）来实现操作，插件同时也是可以定义参数等等。</p>
<h2 id="插件的命名规范"><a href="#插件的命名规范" class="headerlink" title="插件的命名规范"></a>插件的命名规范</h2><ul>
<li>一般插件是使用 ** &lt;你的插件名称&gt;+ -maven-plugin** 来命名</li>
<li>千万不要使用 **  maven-&lt;你的插件名称&gt;-plugin** ，这样是对Apache Maven商标的侵犯😓</li>
</ul>
<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="1-创建一个Maven工程"><a href="#1-创建一个Maven工程" class="headerlink" title="1. 创建一个Maven工程"></a>1. 创建一个Maven工程</h3><ul>
<li>pom配置：增加打包方式      <packaging>maven-plugin</packaging></li>
<li> 需要引入3个依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--plugin插件api--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;maven-plugin-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">     &lt;version&gt;2.0&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line"> &lt;!--加入此包就可以使用@Mojo注解--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.maven.plugin-tools&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;maven-plugin-annotations&lt;&#x2F;artifactId&gt;</span><br><span class="line">     &lt;version&gt;3.1&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!--用户获取运行插件的Maven工程信息--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;maven-project&lt;&#x2F;artifactId&gt;</span><br><span class="line">     &lt;version&gt;3.0-alpha-2&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-HelloWord插件（Mojo）编写"><a href="#2-HelloWord插件（Mojo）编写" class="headerlink" title="2. HelloWord插件（Mojo）编写"></a>2. HelloWord插件（Mojo）编写</h3></li>
<li>处理类需要继承 AbstractMojo ，实现 execute() 方法，execute() 就是我们实际执行的操作</li>
<li>还需要增加@Mojo注解 ，来标示其为一个Mojo类</li>
<li>@Paramete 注解用来直接从pom文件中获取值，其本质就是我们插件的参数，也可以使用表达式来获取参数，像下面的${project} 就是调用MavenSession.getCurrentProject()来获取当前工程</li>
<li>@Paramete的表达式类型 <a target="_blank" rel="noopener" href="http://maven.apache.org/ref/3.6.3/maven-core/apidocs/org/apache/maven/plugin/PluginParameterExpressionEvaluator.html">http://maven.apache.org/ref/3.6.3/maven-core/apidocs/org/apache/maven/plugin/PluginParameterExpressionEvaluator.html</a></li>
<li>MavenProject当前工程的信息，这里就是通过MavenProject获得当前工程的所有文件，然后将java文件和依赖 输出</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">@Mojo(name &#x3D; &quot;hello&quot;,requiresDependencyResolution &#x3D; ResolutionScope.COMPILE)</span><br><span class="line">public class HelloMojo extends AbstractMojo &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * The greeting to display.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Parameter( property &#x3D; &quot;greeting&quot;, defaultValue &#x3D; &quot;Hello World!&quot; )</span><br><span class="line">    private String greeting;</span><br><span class="line"></span><br><span class="line">    @Parameter( defaultValue &#x3D; &quot;$&#123;project&#125;&quot;)</span><br><span class="line">    private MavenProject mavenProject;</span><br><span class="line"></span><br><span class="line">    public void execute() throws MojoExecutionException, MojoFailureException &#123;</span><br><span class="line">        Class&lt;? extends HelloMojo&gt; aClass &#x3D; getClass();</span><br><span class="line"></span><br><span class="line">        System.out.println(aClass);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        getLog().info(&quot;&lt;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;河神说: Hello Mojo start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;&quot;+greeting);</span><br><span class="line"></span><br><span class="line">        List dependencies &#x3D; mavenProject.getDependencies();</span><br><span class="line">        getLog().info(&quot;[dependencies]&quot;);</span><br><span class="line">        for (Object dependency : dependencies) &#123;</span><br><span class="line">            getLog().info(dependency.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        getLog().info(&quot;[basedir]&quot;);</span><br><span class="line">        File basedir &#x3D; mavenProject.getBasedir();</span><br><span class="line"></span><br><span class="line">        List&lt;File&gt; files &#x3D; searchFiles(basedir, &quot;java&quot;);</span><br><span class="line"></span><br><span class="line">        for (File file : files) &#123;</span><br><span class="line">            long l &#x3D; file.lastModified();</span><br><span class="line">            Date date &#x3D; new Date(l);</span><br><span class="line"></span><br><span class="line">            DateFormat dateFormat &#x3D; new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">            String format &#x3D; dateFormat.format(date);</span><br><span class="line">            getLog().info(file.getName()+&quot;[lastModified]&quot;+format);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        getLog().info(&quot;&lt;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;河神说: Hello Mojo end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;&quot;+greeting);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;File&gt; searchFiles(File folder, final String keyword) &#123;</span><br><span class="line">        List&lt;File&gt; result &#x3D; new ArrayList&lt;File&gt;();</span><br><span class="line">        if (folder.isFile())&#123;</span><br><span class="line">            result.add(folder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File[] subFolders &#x3D; folder.listFiles(new FileFilter() &#123;</span><br><span class="line">            public boolean accept(File file) &#123;</span><br><span class="line">                if (file.isDirectory()) &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                return file.getName().toLowerCase().endsWith(keyword);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        if (subFolders !&#x3D; null) &#123;</span><br><span class="line">            for (File file : subFolders) &#123;</span><br><span class="line">                if (file.isFile()) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 如果是文件则将文件添加到结果列表中</span><br><span class="line">                    result.add(file);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    &#x2F;&#x2F; 如果是文件夹，则递归调用本方法，然后把所有的文件加到结果列表中</span><br><span class="line">                    result.addAll(searchFiles(file, keyword));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li> 使用：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;com.heshen&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;api-check-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;greeting&gt;设置的参数&lt;&#x2F;greeting&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;phase&gt;install&lt;&#x2F;phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;hello&lt;&#x2F;goal&gt;</span><br><span class="line">                    &lt;&#x2F;goals&gt;</span><br><span class="line">                &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure></li>
<li>首先需要在<build>/ <plugins>下面增加一个新的 plugin</li>
<li>然后之后就是我们自己定义的groupId/artifactId/version</li>
<li>然后&lt; configuration&gt;就是配置我们之前设置的参数</li>
<li>executions标示我们的插件是在什么时候执行，phase代表声明周期，goal为插件的名称，也就是@Mojo的name,像我们图中配置的，就是在我们install的时候执行的</li>
</ul>
<h3 id="3-直接运行"><a href="#3-直接运行" class="headerlink" title="3. 直接运行"></a>3. 直接运行</h3><ul>
<li>mvnDebug groupID:artifactID:version:goal</li>
<li>或者在settings.xml配置 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;pluginGroups&gt;</span><br><span class="line">  &lt;pluginGroup&gt;  groupID &lt;&#x2F; pluginGroup&gt;</span><br><span class="line">&lt;&#x2F; pluginGroups&gt;</span><br></pre></td></tr></table></figure>
就可以直接使用  mvnDebug  goal 来执行</li>
</ul>
<hr>
<p>桃花坞里桃花庵，桃花庵下桃花仙;<br>桃花仙人种桃树，又摘桃花卖酒钱。</p>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/09/java/RockeqMq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/09/java/RockeqMq/" class="post-title-link" itemprop="url">RockeqMQ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-09T00:00:00+08:00">2020-02-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-18 16:48:38" itemprop="dateModified" datetime="2021-02-18T16:48:38+08:00">2021-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="架构组成"><a href="#架构组成" class="headerlink" title="架构组成"></a>架构组成</h1><h2 id="NameServer"><a href="#NameServer" class="headerlink" title="NameServer"></a>NameServer</h2><ul>
<li>无状态的元数据管理</li>
<li>元数据（Border的信息，包含名称，地址，集群，以及心跳时间）</li>
<li>无主从概念，多个NameServer可以组成一个集群<h3 id="路由信息"><a href="#路由信息" class="headerlink" title="路由信息"></a>路由信息</h3></li>
<li>Topic消息队列路由信息，消息发送时根据路由表进行负载均衡。</li>
<li>Broker基础信息，包含brokerName、所属集群名称、主备Broker地址。</li>
<li>Broker集群信息，存储集群中所有Broker名称。</li>
<li>Broker状态信息。NameServer每次收到心跳包时会替换该信息。</li>
<li>Broker上的FilterServer列表，用于类模式消息过滤<h3 id="路由信息的注册与发现"><a href="#路由信息的注册与发现" class="headerlink" title="路由信息的注册与发现"></a>路由信息的注册与发现</h3></li>
<li>Broker启动时向集群中所有的NameServer发送心跳语句，每隔30s向集群中所有NameServer发送心跳包，NameServer收到Broker心跳包时会更新brokerLiveTable缓存中BrokerLiveInfo的lastUpdate Timestamp，然后NameServer每隔10s扫描brokerLiveTable，如果连续120s没有收到心跳包，NameServer将移除该Broker的路由信息同时关闭Socket连接。<br><img src="https://upload-images.jianshu.io/upload_images/13349286-2d1f7207646cd39d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NameServer流程"></li>
</ul>
<h2 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h2><ul>
<li>消息代理，负责存储消息，处理生产者，消费者的各种请求的代理。</li>
<li>实现主从架构</li>
</ul>
<h2 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h2><h3 id="消息的基础属性"><a href="#消息的基础属性" class="headerlink" title="消息的基础属性"></a>消息的基础属性</h3><ul>
<li>tag 消息TAG，用于消息过滤</li>
<li>delayTimeLevel：消息延迟级别，用于定时消息或消息重试。</li>
<li>key Message索引键，多个用空格隔开，RocketMQ可以根据这些key快速检索到消息</li>
<li>waitStoreMsgOK：消息发送时是否等消息存储完成后再返回<h3 id="消息的发送流程"><a href="#消息的发送流程" class="headerlink" title="消息的发送流程"></a>消息的发送流程</h3><h4 id="验证消息："><a href="#验证消息：" class="headerlink" title="验证消息："></a>验证消息：</h4>验证消息的合法性，消息的最大长度不能超过4M</li>
</ul>
<h4 id="查找路由："><a href="#查找路由：" class="headerlink" title="查找路由："></a>查找路由：</h4><ul>
<li>如果本地路由表中未缓存topic的路由信息，向Name-Server发送获取路由信息请求，更新本地路由信息表，如果未找到则会抛出异常。并且消息生产者每隔30s从Name-Server更新路由表。</li>
</ul>
<h4 id="消息发送（包含异常处理机制）"><a href="#消息发送（包含异常处理机制）" class="headerlink" title="消息发送（包含异常处理机制）"></a>消息发送（包含异常处理机制）</h4><p>消息发送高可用主要通过两个手段：重试与Broker规避。<strong>Broker规避就是在一次消息发送过程中发现错误，在某一时间段内，消息生产者不会选择该Broker（消息服务器）上的消息队列，提高发送消息的成功率</strong>。</p>
<h2 id="消息消费"><a href="#消息消费" class="headerlink" title="消息消费"></a>消息消费</h2><h2 id="消费组"><a href="#消费组" class="headerlink" title="消费组"></a>消费组</h2><p>RocketMq的消费以消费组的模式展开，一个消费组可以订阅多个主题，一个消费组里面也有多个消费者</p>
<h2 id="广播模式和集群模式"><a href="#广播模式和集群模式" class="headerlink" title="广播模式和集群模式"></a>广播模式和集群模式</h2><ul>
<li>消费组之间有集群模式与广播模式两种消费模式。集群模式，主题下的同一条消息只允许被其中一个消费者消费。广播模式，主题下的同一条消息将被集群内的所有消费者消费一次。</li>
<li>集群模式下：一个消息队列同一时间只允许被一个消费者消费，一个消费者可以消费多个消息队列。</li>
</ul>
<h2 id="消息的推和拉"><a href="#消息的推和拉" class="headerlink" title="消息的推和拉"></a>消息的推和拉</h2><p>消息服务器与消费者之间的消息传送也有两种方式：推模式、拉模式。所谓的拉模式，是消费端主动发起拉消息请求，而推模式是消息到达消息服务器后，推送给消息消费者。RocketMQ消息推模式的实现基于拉模式，在拉模式上包装一层，一个拉取任务完成后开始下一个拉取任务。</p>
<h3 id="拉模式"><a href="#拉模式" class="headerlink" title="拉模式"></a>拉模式</h3><ul>
<li>用户自行实现取消息的过程</li>
<li>拉模式采用一个单独的线程负责消息的拉取</li>
<li>每次默认从服务端拉取32条消息，存入消息队列处理队列，将消息提交到消费者消费线程池，使用线程池来消费消息，保证了消息拉取和消息消费的解耦。</li>
<li>如果消息消费过慢产生消息堆积会触发消息消费拉取流控。</li>
<li>广播消息消费进度存储在消费者端，集群消费进度存储在Broker<h3 id="推模式"><a href="#推模式" class="headerlink" title="推模式"></a>推模式</h3></li>
<li>consumer把轮询过程封装了，并注册MessageListener监听器，取到消息后，唤醒MessageListener的consumeMessage()来消费，对用户而言，感觉消息是被推送（push）过来的。</li>
</ul>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>RocketMQ是消费者首先向主服务器发起拉取消息请求，然后主服务器返回一批消息，然后会根据主服务器负载压力与主从同步情况，向从服务器建议下次消息拉取是从主服务器还是从从服务器拉取（如当前需要拉取的消息已经超出了常驻内存的大小，表示主服务器繁忙，此时才建议从从服务器拉取。）。</p>
<h2 id="局部顺序消息消"><a href="#局部顺序消息消" class="headerlink" title="局部顺序消息消"></a>局部顺序消息消</h2><p>RocketMQ支持局部顺序消息消费，也就是保证同一个消息队列上的消息顺序消费。不支持消息全局顺序消费，如果要实现某一主题的全局顺序消息消费，可以将该主题的队列数设置为1，牺牲高可用性。</p>
<h1 id="消息存储"><a href="#消息存储" class="headerlink" title="消息存储"></a>消息存储</h1><h2 id="文件过期删除"><a href="#文件过期删除" class="headerlink" title="文件过期删除"></a>文件过期删除</h2><ul>
<li>RocketMQ不会永久存储消息文件、消息消费队列文件，而是启用文件过期机制并在磁盘空间不足或默认在凌晨4点删除过期文件，文件默认保存72小时并且在删除文件时并不会判断该消息文件上的消息是否被消费。</li>
<li>所以如果长时间不消费可能消息丢失</li>
</ul>
<h1 id="同步复制、异步复制和同步刷盘、异步刷盘"><a href="#同步复制、异步复制和同步刷盘、异步刷盘" class="headerlink" title="同步复制、异步复制和同步刷盘、异步刷盘"></a>同步复制、异步复制和同步刷盘、异步刷盘</h1><h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><ul>
<li>指的是不同Boker节点之间数据同步</li>
<li>同步复制指的是生产者等待同步复制成功之后，才返回消息发送成功</li>
<li>异步复制指的是写入Master Borker之后，立即返回成功，而不等待消息复制完成<h2 id="刷盘"><a href="#刷盘" class="headerlink" title="刷盘"></a>刷盘</h2></li>
<li>指的是数据同步到内存后同步到磁盘的过程</li>
<li>同步刷盘指的是生产者等待消息持久化之后才返回成功</li>
<li>异步刷盘指的是只要消息写入缓存之中，就认为写入成功，立即返回成功，到达一定量之后再出发异步刷盘</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一般同步可靠性强，异步吞吐量强。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-bebfb7296723f84a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="刷盘和复制"></p>
<h1 id="消息的推和拉-1"><a href="#消息的推和拉-1" class="headerlink" title="消息的推和拉"></a>消息的推和拉</h1><ul>
<li>消息的消费默认有两种模式，广播模式和集群模式。广播模式为消费者之间去消费对应订阅主题下面的消息。集群模式的话同一个消费组下面有多个消费者，同一个主题也有多个消费队列。</li>
</ul>
<h1 id="事务消息"><a href="#事务消息" class="headerlink" title="事务消息"></a>事务消息</h1><p><img src="https://upload-images.jianshu.io/upload_images/13349286-6cd82a4ba08d03de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<hr>
<h5 id="rocketMq"><a href="#rocketMq" class="headerlink" title="rocketMq:"></a>rocketMq:</h5><p><img src="https://upload-images.jianshu.io/upload_images/13349286-16d72117c80a4a62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h5 id="事务消息发送步骤如下："><a href="#事务消息发送步骤如下：" class="headerlink" title="事务消息发送步骤如下："></a>事务消息发送步骤如下：</h5><ol>
<li>发送方将半事务消息发送至消息队列 RocketMQ 版服务端。</li>
<li>消息队列 RocketMQ 版服务端将消息持久化成功之后，向发送方返回 Ack 确认消息已经发送成功，此时消息为半事务消息。</li>
<li>发送方开始执行本地事务逻辑。</li>
<li>发送方根据本地事务执行结果向服务端提交二次确认（Commit 或是 Rollback），<br>服务端收到 Commit 状态则将半事务消息标记为可投递，订阅方最终将收到该消息；<br>服务端收到 Rollback 状态则删除半事务消息，订阅方将不会接受该消息。</li>
</ol>
<h5 id="事务消息回查步骤如下："><a href="#事务消息回查步骤如下：" class="headerlink" title="事务消息回查步骤如下："></a>事务消息回查步骤如下：</h5><p>  在断网或者是应用重启的特殊情况下，上述步骤 4 提交的二次确认最终未到达服务端，经过固定时间后服务端将对该消息发起消息回查。<br>  发送方收到消息回查后，需要检查对应消息的本地事务执行的最终结果。<br>发送方根据检查得到的本地事务的最终状态再次提交二次确认，服务端仍按照步骤 4 对半事务消息进行操作。</p>
<hr>
<p>源：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/43348.html?spm=5176.ons.0.0.513e176fgmrjdo">https://help.aliyun.com/document_detail/43348.html?spm=5176.ons.0.0.513e176fgmrjdo</a></p>
<hr>
<p>基于本地事务的消息<br><img src="https://upload-images.jianshu.io/upload_images/13349286-88dea15b08962d09.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/01/30/java/%E8%B7%B3%E8%B7%83%E8%A1%A8%E5%92%8CConcurrentSkipListMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/30/java/%E8%B7%B3%E8%B7%83%E8%A1%A8%E5%92%8CConcurrentSkipListMap/" class="post-title-link" itemprop="url">跳跃表和ConcurrentSkipListMap</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-30T00:00:00+08:00">2020-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-12 22:19:21" itemprop="dateModified" datetime="2021-01-12T22:19:21+08:00">2021-01-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="跳跃表"><a href="#跳跃表" class="headerlink" title="跳跃表"></a>跳跃表</h3><h5 id="跳跃表是什么"><a href="#跳跃表是什么" class="headerlink" title="跳跃表是什么"></a>跳跃表是什么</h5><ol>
<li> 跳跃表是一种有序的数据结构，通过每个节点维持指向多个其他节点的指针，来达到快速访问节点，</li>
<li>查找复杂度： 平均O(log n) 最坏 O(n) ，在大部分情况下，效率与平衡树相差不大，</li>
<li> 跳跃表就通过在一个 有序数组中 ，随机找出一半的索引，而在这一半的索引里面又随机抽出一半的索引，这样每次查找数据，就不需要没有都便利整个列表，只需要跟着跳跃表一步一步的找，</li>
<li>每一次的添加，都会从最底层开始抛硬币，来决定这个节点是否为需要提拔为索引</li>
<li>跳跃表在redis中也有应用，redis中的有序集合的实现方式之一是跳跃表，当一个有序集合包含元素多，或者元素的成员为比较长的字符串的时候，redis就会使用跳跃表来作为底层数据结果实现，redis中另一个使用是集群节点作为内部数据结构（待了解）</li>
</ol>
<h3 id="ConcurrentSkipListMap"><a href="#ConcurrentSkipListMap" class="headerlink" title="ConcurrentSkipListMap"></a>ConcurrentSkipListMap</h3><h4 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h4><p>  存取数据量大，增删改查频繁，且对数据没有强一致性要求的高并发场景</p>
<h4 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h4><ol>
<li>基于跳跃表实现，具有弱一致性</li>
<li>key 不能为null</li>
<li>主要实现包含  HeadIndex  Index Node 三个类。通过HeadIndex来维护索引层次，通过index从上往下，一直到最底层Node节点的时候，就只需要比较比较少的一部分数据。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">* Head nodes          Index nodes</span><br><span class="line">* +-+    right        +-+                      +-+</span><br><span class="line">* |2|----------------&gt;| |---------------------&gt;| |-&gt;null</span><br><span class="line">* +-+                 +-+                      +-+</span><br><span class="line">*  | down              |                        |</span><br><span class="line">*  v                   v                        v</span><br><span class="line">* +-+            +-+  +-+       +-+            +-+       +-+</span><br><span class="line">* |1|-----------&gt;| |-&gt;| |------&gt;| |-----------&gt;| |------&gt;| |-&gt;null</span><br><span class="line">* +-+            +-+  +-+       +-+            +-+       +-+</span><br><span class="line">*  v              |    |         |              |         |</span><br><span class="line">* Nodes  next     v    v         v              v         v</span><br><span class="line">* +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+</span><br><span class="line">* | |-&gt;|A|-&gt;|B|-&gt;|C|-&gt;|D|-&gt;|E|-&gt;|F|-&gt;|G|-&gt;|H|-&gt;|I|-&gt;|J|-&gt;|K|-&gt;null</span><br><span class="line">* +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+</span><br></pre></td></tr></table></figure>
<h2 id="put方法"><a href="#put方法" class="headerlink" title="put方法"></a>put方法</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/01/12/docker/Docker%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/12/docker/Docker%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Docker基础操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-12 14:39:31" itemprop="dateCreated datePublished" datetime="2020-01-12T14:39:31+08:00">2020-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-16 14:38:48" itemprop="dateModified" datetime="2021-01-16T14:38:48+08:00">2021-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">运维类</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>安装<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-io –y</span><br><span class="line">systemctl start docker</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure></li>
<li>命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker [run|start|stop|restart|kill|rm|pause|unpause]             </span><br><span class="line">#容器生命周期管理</span><br><span class="line">docker [ps|inspect|top|attach|events|logs|wait|export|port]       </span><br><span class="line">#容器操作运维</span><br><span class="line">docker [commit|cp|diff]                                           </span><br><span class="line">#容器rootfs命令</span><br><span class="line">docker [login|pull|push|search]</span><br><span class="line">#镜像仓库</span><br><span class="line">docker [images|rmi|tag|build|history|save|import]</span><br><span class="line">#查看镜像详情</span><br><span class="line">docker inspect : 获取容器&#x2F;镜像的元数据</span><br><span class="line">#本地镜像管理</span><br><span class="line">docker exec -ti $1 &#x2F;bin&#x2F;bash</span><br><span class="line">#进入docker容器内部</span><br></pre></td></tr></table></figure></li>
<li>简单使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">docker pull image_name</span><br><span class="line">docker pull image_name:tag</span><br><span class="line">#image_name：表示镜像的仓库源名称,TAG：镜像的标签 如果不指定tag 那么默认用最新的</span><br><span class="line"></span><br><span class="line">docker rmi 镜像名称&#x2F;镜像ID</span><br><span class="line">docker rmi -f 镜像名称&#x2F;镜像ID</span><br><span class="line">#强制删除 如果镜像有容器在运行 那么就需要强制删除 增加 -f 参数</span><br><span class="line"></span><br><span class="line">docker run -d --name &quot;xiaoxiao&quot; -p 5672:5672 -p 15672:15672 -v &#x2F;home&#x2F;dock&#x2F;Downloads:&#x2F;usr&#x2F;Downloads:ro  rabbitmq:management</span><br><span class="line">            #-d 后台运行</span><br><span class="line">            #-p 端口映射 （可以有多个 因为该镜像可能存在多个端口）</span><br><span class="line">            #通过-v参数，冒号前为宿主机目录，必须为绝对路径，冒号后为镜像内挂载的路径。默认挂载的路径权限为读写。如果指定为只读可以用：ro</span><br><span class="line">            #rabbitmq:management  (格式 REPOSITORY:TAG)，如果不指定tag，默认使用最新的</span><br><span class="line">            #--name  给该容器取个名字</span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li>数据卷<blockquote>
<p>Docker管理宿主机文件系统的一部分，默认位于 /var/lib/docker/volumes 目录中；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker volume create edc-nginx-vol &#x2F;&#x2F; 创建一个自定义容器卷</span><br><span class="line">docker volume ls &#x2F;&#x2F; 查看所有容器卷</span><br><span class="line">docker volume inspect edc-nginx-vol &#x2F;&#x2F; 查看指定容器卷详情信息</span><br><span class="line"></span><br><span class="line">#使用 -v edc-nginx-vol:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html 在run容器的时候就可以把数据卷挂载 </span><br><span class="line"></span><br><span class="line">docker stop edc-nginx &#x2F;&#x2F; 暂停容器实例</span><br><span class="line">docker rm edc-nginx &#x2F;&#x2F; 移除容器实例</span><br><span class="line">docker volume rm edc-nginx-vol &#x2F;&#x2F; 删除自定义数据卷 </span><br></pre></td></tr></table></figure></li>
<li>tag <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m &#39;测试&#39; -a &#39;heShen&#39; 35f2d8da9f3a heshentest:v1</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 其中，-m 来指定提交的说明信息，跟我们使用的版本控制工具一样；-a 可以指定更新的用户信息；</span><br><span class="line">&#x2F;&#x2F;之后是用来创建镜像的容器的 ID；最后指定目标镜像的仓库名和 tag 信息。创建成功后会返回这个镜像的 ID 信息。</span><br><span class="line">&#x2F;&#x2F;使用 docker images 来查看新创建的镜像。</span><br></pre></td></tr></table></figure></li>
<li>保存镜像为文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;保存镜像为文件</span><br><span class="line">docker save -o 要保存的文件名  要保存的镜像</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;从文件载入镜像</span><br><span class="line">docker load --input 文件</span><br><span class="line">docker load &lt; 文件名</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>Dockerfile使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 新建 Dockerfile 文件</span><br><span class="line">2. 添加</span><br><span class="line">    FROM nginx</span><br><span class="line">    #FROM：定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx</span><br><span class="line">    RUN echo &#39;这是一个本地构建的nginx镜像&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br><span class="line">    #RUN：用于执行后面跟着的命令行命令</span><br><span class="line">3. docker build -t nginx:test .</span><br><span class="line">    # 构建镜像，最后的 . 代表本次执行的上下文路径，</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li>RUN使用：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RUN &lt;命令行命令&gt;</span><br><span class="line"> &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span><br><span class="line">RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]</span><br><span class="line"> 例如：</span><br><span class="line"> RUN [&quot;.&#x2F;test.php&quot;, &quot;dev&quot;, &quot;offline&quot;] 等价于 RUN .&#x2F;test.php dev offline</span><br></pre></td></tr></table></figure></li>
<li>上下文路径<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</span><br><span class="line"></span><br><span class="line">解析：由于 docker 的运行模式是 C&#x2F;S。我们本机是 C，docker 引擎是 S。</span><br><span class="line">实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</span><br><span class="line"></span><br><span class="line">如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</span><br><span class="line"></span><br><span class="line">注意：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="河神"
      src="https://z3.ax1x.com/2021/05/30/2VQ8M9.jpg">
  <p class="site-author-name" itemprop="name">河神</p>
  <div class="site-description" itemprop="description">你可以跑,但你不能躲</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/40227ed13cdc" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;40227ed13cdc" rel="noopener" target="_blank">简书</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">河神</span>
</div>


<a class="theme-link" target="_blank" href="https://www.jianshu.com/u/40227ed13cdc">桃花深处有人家</a>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_lines.min.js"></script>


  















  

  


  <script type="text/javascript" src="/js/click.js"></script>

</body>
</html>
