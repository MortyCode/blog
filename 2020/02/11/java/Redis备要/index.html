<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.rcode.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#abc","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="书单：  《 Redis的设计与实现》        《Netty、Redis、Zookeeper高并发实战》   1. Redis是什么Redis是一个C语言开发的高性能Key-Value数据库。  2. Redis的使用场景 缓存 分布式锁 GEO可以支持地理位置搜索 消息订阅2.1缓存2.1.1 缓存穿透缓存穿透指的客户端不断的查询一个数据库不存在的值，多次缓存都没有命中，缓存失去了存">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis备要">
<meta property="og:url" content="http://www.rcode.top/2020/02/11/java/Redis%E5%A4%87%E8%A6%81/index.html">
<meta property="og:site_name" content="Rick-Code">
<meta property="og:description" content="书单：  《 Redis的设计与实现》        《Netty、Redis、Zookeeper高并发实战》   1. Redis是什么Redis是一个C语言开发的高性能Key-Value数据库。  2. Redis的使用场景 缓存 分布式锁 GEO可以支持地理位置搜索 消息订阅2.1缓存2.1.1 缓存穿透缓存穿透指的客户端不断的查询一个数据库不存在的值，多次缓存都没有命中，缓存失去了存">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13349286-1071625264fa0153.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13349286-8b39131c2f6ea462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13349286-6d323150658f06c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13349286-ff359fcdfa5b4b10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13349286-dc2a345e872321ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2020-02-10T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T08:47:53.468Z">
<meta property="article:author" content="河神">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/13349286-1071625264fa0153.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">

<link rel="canonical" href="http://www.rcode.top/2020/02/11/java/Redis%E5%A4%87%E8%A6%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis备要 | Rick-Code</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rick-Code</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日行一步，且得人生半日闲</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

  
    
  <div class="back-to-top">
      <svg t="1610624158144" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2798" width="80" height="80"><path d="M463.04 956.96a177.6 177.6 0 0 1-37.44-3.04c-9.6-2.24-24-6.88-40.64-12.48a447.04 447.04 0 0 0-64-18.08l-16-0.8c-37.44-1.6-84-3.52-86.24-41.76-1.6-28 24.16-69.76 46.24-99.68A224.96 224.96 0 0 1 288 754.72a261.76 261.76 0 0 1-44.8-56.32h-1.6a113.92 113.92 0 0 1-104.16-68.8A102.4 102.4 0 0 1 128 547.52a87.2 87.2 0 0 1 25.6-37.12c-7.52-33.44-20.8-103.84-12-160A210.08 210.08 0 0 1 192 240c9.92-25.44 51.04-106.56 186.08-151.04a473.44 473.44 0 0 1 145.92-22.4c170.72 0 290.72 80 321.12 214.24s27.84 208 21.44 242.24A80 80 0 0 1 896 615.2c-16 55.2-74.72 67.68-102.56 70.56a513.12 513.12 0 0 1-37.76 46.4c-4 4.16-7.84 7.84-11.52 11.2 28.48 25.28 68.8 64 79.2 91.36a90.24 90.24 0 0 1-2.24 71.36 57.44 57.44 0 0 1-29.44 30.08l-2.24 0.8a226.88 226.88 0 0 1-91.36 14.56c-9.92 0-20.64 0-32-1.12-24.8-1.6-42.24-3.04-55.52-4.16S588.64 944 581.28 944a128 128 0 0 0-28.16 3.68 480 480 0 0 1-90.08 9.28z" fill="#FFFFFF" p-id="2799"></path><path d="M184.64 522.24s-27.04-97.92-16-167.04a171.84 171.84 0 0 1 47.04-99.2S240 163.36 386.56 115.36s388-23.04 432 172.64 16 250.08 16 250.08A55.2 55.2 0 0 1 870.56 608c-16 52.96-91.04 52-91.04 52A559.04 559.04 0 0 1 736 713.28a126.72 126.72 0 0 1-36 28s84.96 68.96 98.08 103.04-5.92 63.04-15.04 66.08-35.04 18.08-116 12.96-81.92-9.92-120-1.92A368 368 0 0 1 432 928c-21.92-4.96-84-28.96-108-31.04S247.68 896 246.56 880s19.04-52.64 41.44-82.72a167.68 167.68 0 0 1 44-43.04 211.36 211.36 0 0 1-72.96-84.96s-61.92 16.96-96.96-52 22.56-95.04 22.56-95.04z" fill="#1D1D1B" p-id="2800"></path><path d="M206.56 505.28s-36.96-108-11.04-159.04 28.48-56 28.48-56 44.96-103.04 139.04-134.08S592 98.24 705.6 168.32s114.08 302.08 112.96 315.04-4 14.08-4 14.08a316.8 316.8 0 0 0-51.04-171.04c-55.04-84-120.96-140.96-247.04-139.04S281.6 288 273.6 308.32s-15.04 34.08-15.04 34.08-13.92-20.96-16.96-20.96-11.04 4-8.96 10.08 16.96 22.08 16.96 26.08a75.36 75.36 0 0 1-4 15.04s-24-21.92-28-19.04-4 16-4 16 23.04 24 22.08 27.04a272 272 0 0 0-17.92 64.96 129.28 129.28 0 0 1-11.2 43.68z" fill="#7B5207" p-id="2801"></path><path d="M212.64 552.32s12.96 36.96 20 54.08a112 112 0 0 1 8 31.04 61.6 61.6 0 0 1-49.92-36.96c-13.12-34.24 17.28-44.16 21.92-48.16zM818.56 563.36s-4.96 20-11.04 42.08a116.64 116.64 0 0 1-12 31.04s46.08-3.04 52-29.92a36 36 0 0 0-28.96-43.2zM530.56 218.24c82.08 0 176.96 44.96 227.04 163.04s39.04 236.96-32.96 303.04-136.96 106.08-259.04 87.04-171.04-87.04-208-171.04S240 220.32 530.56 218.24z" fill="#FCD396" p-id="2802"></path><path d="M355.68 768c8.64-6.4 60.96 47.04 179.04 35.04s135.04-43.04 140-43.04 87.04 60.96 98.08 86.08 8.96 42.08 4 43.04a60.8 60.8 0 0 1-13.92 0s-51.04-83.04-60.96-84-12.96 2.08-11.04 7.04 52.96 80 50.08 80.96-12 8.96-17.92 4.96S676.64 832 672 832s-16 3.04-15.04 6.08 46.08 63.04 42.08 64.96a106.24 106.24 0 0 1-23.04 2.08s-40-59.04-45.92-59.04-9.92 10.08-9.92 10.08 35.04 52 31.04 52a334.08 334.08 0 0 0-83.04-9.92c-40 2.08-71.04 18.08-105.92 14.08S384 880 349.6 878.24s-67.04-1.92-68-5.92 10.08-56.32 74.08-104.32z" fill="#FAB900" p-id="2803"></path><path d="M339.68 349.28c-7.36 0 92.96-20 98.08-13.92s8.96 14.08 0.96 14.08-84.16 18.56-91.04 16.8-7.04-16.96-8-16.96zM637.6 339.36c4 0 88 12 88.96 19.04s7.04 8.96-3.04 10.08a736 736 0 0 1-85.92-13.92c-7.04-2.56 0-15.2 0-15.2zM378.56 379.36c55.04-13.12 132-7.04 128.96 91.04s-117.92 114.08-172.96 75.04-56.96-142.08 44-166.08z" fill="#1D1D1B" p-id="2804"></path><path d="M382.24 393.12c46.56-11.04 112-5.92 109.28 77.12s-100 96-146.56 64-48.32-120.8 37.28-141.12z" fill="#FFFFFF" p-id="2805"></path><path d="M614.56 382.24c48-25.28 127.04 2.08 130.08 91.04s-96.96 108-147.04 67.04-60-116.96 16.96-158.08z" fill="#1D1D1B" p-id="2806"></path><path d="M620.96 396.96c39.36-20.96 105.12 1.6 107.52 75.36s-80 89.44-121.6 55.36-49.6-96.8 14.08-130.72z" fill="#FFFFFF" p-id="2807"></path><path d="M392.64 450.24c14.56-11.36 40-7.04 40.96 12a27.2 27.2 0 0 1-37.92 28.96c-25.12-8.96-11.68-33.92-3.04-40.96zM641.6 450.24c14.56-11.36 40-7.04 40.96 12a27.2 27.2 0 0 1-37.92 28.96c-24.96-8.96-12-33.92-3.04-40.96zM508.64 582.24c4.32 0.8 62.08 35.04 70.08 30.08s2.08-28-8-36-8.96-3.04-9.92-8a6.24 6.24 0 0 1 7.04-8 44 44 0 0 1 34.08 36.96c4.96 30.08-12.96 39.04-36.96 32.96a217.44 217.44 0 0 1-65.92-36.96c-3.04-4 4.64-12 9.6-11.04zM416 660.32c7.04-0.96 34.08 34.08 103.04 31.04a293.6 293.6 0 0 0 80-12 15.04 15.04 0 0 1 12 14.08c-0.96 3.04-45.92 22.08-113.92 16-71.36-6.24-91.04-32.96-92.96-36.96s4.48-11.2 11.84-12.16z" fill="#1D1D1B" p-id="2808"></path></svg>
      <svg t="1610639708230" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2073" width="80" height="80"><path d="M298 771.3h89.7v44.8H298zM477.3 771.3H567v44.8h-89.7z" fill="#206BAB" p-id="2074"></path><path d="M656.7 771.3h89.7v44.8h-89.7z" fill="#206BAB" p-id="2075"></path><path d="M492.3 68.9L93.5 693.6c-21.4 33.5 2.8 77.3 42.5 77.1h774.1c37.4-0.2 63.9-46.5 43.6-77.9L552 68.9c-24-35.8-35.9-35.8-59.7 0z m0 0" fill="#EEAC38" p-id="2076"></path><path d="M136 770.7c-39.7 0.2-63.9-43.6-42.5-77.1L492.3 68.9s8.9-17.3 25.8-14.9l4 716.8H136z m0 0" fill="#F0BB5D" p-id="2077"></path><path d="M581.9 128.6H462.4s34.5-74.1 57.9-74.7c36.2-0.9 61.6 74.7 61.6 74.7z m0 0" fill="#74A2CA" p-id="2078"></path><path d="M402.6 771.3H283V547.1c0-33 26.8-59.8 59.8-59.8s59.8 26.8 59.8 59.8v224.2z m0 0" fill="#206BAB" p-id="2079"></path><path d="M283 711.5h119.6v59.8H283z" fill="#FFFFFF" p-id="2080"></path><path d="M761.3 771.3H641.7V547.1c0-33 26.8-59.8 59.8-59.8s59.8 26.8 59.8 59.8v224.2z m0 0" fill="#206BAB" p-id="2081"></path><path d="M641.7 711.5h119.6v59.8H641.7z" fill="#FFFFFF" p-id="2082"></path><path d="M178.4 771.3h-47.7c-31.5 0-51.1-29.7-42-59.8 11.7-38.7 89.7-151 89.7-151v210.8z m0 0M865.9 771.3h47.7c31.5 0 53.4-32.4 44.2-62.5-11.7-38.7-91.9-152.4-91.9-152.4v214.9z m0 0" fill="#74A2CA" p-id="2083"></path><path d="M626.8 317.6c0-57.8-46.8-104.6-104.6-104.6s-104.6 46.8-104.6 104.6l104.6 59.8 104.6-59.8z m0 0" fill="#FFFFFF" p-id="2084"></path><path d="M298 831h29.9v44.8h29.9V831h29.9v-29.9H298V831z m0 0M746.3 801.2h-89.7V831h29.9v44.8h29.9V831h29.9v-29.8z m0 0M567 801.2h-89.7V831h29.9v44.8h29.9V831H567v-29.8z m0 0M73.8 801.2h29.9v209.2H73.8zM133.6 875.9h29.9v104.6h-29.9zM178.4 801.2h29.9V846h-29.9zM940.6 801.2h29.9v209.2h-29.9zM880.8 875.9h29.9v104.6h-29.9zM836 801.2h29.9V846H836zM487.9 303.6l-21.1-21.1 29.9-29.9 21.1 21.1-29.9 29.9z m0 0M547.7 303.6l-21.1-21.1 29.9-29.9 21.1 21.1-29.9 29.9z m0 0M327.9 905.8h29.9v104.6h-29.9zM507.2 905.8h29.9v104.6h-29.9zM686.6 905.8h29.9v104.6h-29.9z" fill="#1C1C1A" p-id="2085"></path><path d="M447.4 517.2h29.9v29.9h-29.9zM447.4 577h29.9v29.9h-29.9zM447.4 636.8h29.9v29.9h-29.9zM567 577h29.9v29.9H567zM567 636.8h29.9v29.9H567z" fill="#FFFFFF" p-id="2086"></path><path d="M567 517.2h29.9v29.9H567z" fill="#FFFFFF" p-id="2087"></path><path d="M961 698.2L568.2 64.6c-9.9-16-27.1-25.6-46-25.6s-36.1 9.6-46 25.6L83.3 698.2c-10.5 16.9-11 37.4-1.3 54.9 9.7 17.4 27.4 27.8 47.3 27.8H915c19.9 0 37.6-10.4 47.3-27.8 9.7-17.4 9.2-37.9-1.3-54.9zM701.5 502.3c24.7 0 44.8 20.1 44.8 44.8v149.5h-89.7V547.1c0.1-24.7 20.2-44.8 44.9-44.8z m-44.8 224.1h89.7V751h-89.7v-24.6z m59.7-252.5v-31.4h-29.9v31.4c-34.1 6.9-59.8 37.1-59.8 73.2V751H537V386l104.6-59.8v-8.7c0-65.9-53.6-119.6-119.6-119.6s-119.6 53.6-119.6 119.6v8.7L507 386v365h-89.7V547.1c0-36.1-25.7-66.3-59.8-73.2v-31.4h-29.9v31.4c-34.1 6.9-59.8 37.1-59.8 73.2V751h-74.7V577.4l269-433.8H582l269 433.8V751h-74.7V547.1c-0.1-36.1-25.8-66.3-59.9-73.2zM522.2 360.2l-89.3-51c4.3-45.5 42.7-81.2 89.3-81.2 46.6 0 85 35.7 89.3 81.2l-89.3 51zM342.8 502.3c24.7 0 44.8 20.1 44.8 44.8v149.5H298V547.1c0-24.7 20.1-44.8 44.8-44.8zM298 726.4h89.7V751H298v-24.6zM501.5 80.3c4.5-7.3 12-11.5 20.6-11.5s16.1 4.2 20.6 11.5l20.7 33.4h-82.6l20.7-33.4zM108.1 738.6c-4.3-7.8-4.1-17 0.6-24.6l54.8-88.4V751h-34.2c-8.9 0-16.9-4.6-21.2-12.4z m828.1 0c-4.3 7.8-12.3 12.5-21.2 12.5h-34.2V625.6l54.8 88.4c4.7 7.6 5 16.8 0.6 24.6z m0 0" fill="#1C1C1A" p-id="2088"></path></svg>
  </div>


  <a href="https://gitee.com/haipengliang/" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg t="1610623934263" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2440" width="100" height="100"><path d="M524.96 1009.28a51.68 51.68 0 0 1-10.88-1.28H488.16c-14.88 0-42.24 0-49.28-23.84a134.24 134.24 0 0 1-3.2-26.88 185.28 185.28 0 0 1-60.96-20.16 221.76 221.76 0 0 1-23.04-16 158.72 158.72 0 0 1-73.28 31.2 309.28 309.28 0 0 1-35.84 2.24c-36.96 0-48-8-53.44-16a28.8 28.8 0 0 1-3.84-26.56c2.88-8.48 13.44-44.16 19.84-69.92-45.12 2.24-119.68 5.92-126.72 5.92a49.76 49.76 0 0 1-40.8-22.88 39.68 39.68 0 0 1-3.52-38.56c5.44-12 65.76-112 92.32-138.88l5.92-5.92a261.76 261.76 0 0 0-43.52-9.28c-16-1.76-68.48-9.6-84.16-34.88a29.92 29.92 0 0 1-2.88-26.08A377.6 377.6 0 0 1 80 473.44c14.4-11.52 28-22.4 38.72-30.72a487.52 487.52 0 0 1-57.44-92.64c-25.44-54.4-35.52-100-27.04-122.08a32 32 0 0 1 17.12-17.92 69.44 69.44 0 0 1 27.2-2.88c16 0 42.72 0 68.96 1.44 23.36 0 46.72 1.44 63.04 1.44h34.24c-2.4-24.16-6.08-60.64-9.6-84.32-1.6-11.68-3.36-22.08-4.8-30.88-5.44-34.08-9.44-58.72 18.24-64a34.24 34.24 0 0 1 7.2 0 496 496 0 0 1 144 33.28 305.44 305.44 0 0 1 89.76 48 604 604 0 0 1 136.16-72.16A336 336 0 0 1 730.08 14.72 42.72 42.72 0 0 1 768 32c6.24 10.72 6.24 10.72-8.8 89.44-4.48 23.04-10.88 56.48-14.72 80a379.52 379.52 0 0 0 67.36-14.4c22.24-7.2 52-20.16 76-30.56 34.24-14.72 42.56-18.24 51.36-18.24h2.72a29.44 29.44 0 0 1 22.72 14.72c13.12 22.08 10.24 85.28-17.28 148.64l-10.56 24 5.44-2.24a103.36 103.36 0 0 1 38.72-10.24A35.04 35.04 0 0 1 1016.32 336a269.12 269.12 0 0 1-45.12 193.44 419.36 419.36 0 0 1-50.24 57.28l7.68 1.76c15.04 3.2 27.84 5.12 38.24 6.88 27.68 4.48 58.88 9.6 57.28 41.12a209.92 209.92 0 0 1-98.56 140L884.16 800l-13.28 7.84a873.92 873.92 0 0 1-1.92 117.12c-6.4 21.6-34.4 36.8-67.84 36.8a128 128 0 0 1-22.56-1.76 372.96 372.96 0 0 1-102.24-34.72c-2.88-1.92-5.76-4.16-8.32-6.08-19.36 10.08-48 24.8-58.88 28.96l-8.8 3.04c0 30.88-1.76 33.44-4.16 38.24A38.08 38.08 0 0 1 561.12 1008a39.68 39.68 0 0 1-10.56-1.44h-2.88a80 80 0 0 0-11.04 0.8 77.76 77.76 0 0 1-11.68 1.92z" fill="#FFFFFF" p-id="2441"></path><path d="M157.76 446.88a448 448 0 0 1-72-108.32c-30.4-64.8-30.72-100.8-24-103.36s104.32 1.76 148.8 2.08 64 0 64-2.56-6.56-73.76-12.16-112.8-11.2-64-7.84-64.96a444 444 0 0 1 135.84 32c80 29.28 96 57.76 96 57.76A606.08 606.08 0 0 1 634.24 64c77.44-27.2 108.16-23.36 110.72-18.88s-36.48 182.24-29.76 184.32a355.36 355.36 0 0 0 105.44-17.44c43.68-14.24 112-48 119.2-48s13.12 56.32-16.96 125.76-37.28 78.72-34.56 80a448 448 0 0 0 64.96-21.76c22.56-9.44 34.4-10.88 37.12-2.88a246.24 246.24 0 0 1-41.12 168.32c-51.2 68.16-73.76 71.68-75.84 74.4s0 17.28 49.44 27.52 74.4 9.44 73.92 20a186.08 186.08 0 0 1-84.8 117.92c-65.44 39.04-69.44 39.04-68 44.32s2.24 112 0 120.16-24.48 22.08-59.68 16a355.52 355.52 0 0 1-91.84-30.56 131.84 131.84 0 0 1-19.36-16s-58.88 31.04-72.8 36.48a117.6 117.6 0 0 1-25.92 6.88s0 45.12-1.6 48a16 16 0 0 1-13.92 3.36 78.88 78.88 0 0 0-25.28 0 33.92 33.92 0 0 1-16 0 160 160 0 0 0-25.28 0c-7.36 0-25.28 0-26.56-4.48s-3.68-43.2-3.68-43.2a204.32 204.32 0 0 1-72.48-19.36A136.8 136.8 0 0 1 352 885.12a150.56 150.56 0 0 1-77.44 40.48c-42.4 4.96-65.12 0-64-3.52s33.76-109.28 25.76-108.48-146.72 6.4-158.08 6.56-24-13.12-19.52-23.04 64-108.16 86.72-130.88 34.88-36.8 34.88-36.8a356 356 0 0 0-88.48-24.48c-43.84-4.96-66.56-19.36-64-24.8a370.24 370.24 0 0 1 69.76-85.6c31.68-26.08 60.16-47.68 60.16-47.68z" fill="#1D1D1B" p-id="2442"></path><path d="M93.76 261.44c4.8-4.8 215.84 0.96 216.48-3.04S280.32 80 286.4 80a733.92 733.92 0 0 1 144 59.36c42.08 26.88 44.16 36.8 55.36 36.16s64-51.04 134.88-78.08 94.72-28.64 94.72-25.92-22.88 116.8-27.36 138.08-7.04 43.84-2.24 45.12a446.72 446.72 0 0 0 132-16c63.04-17.76 108-42.72 108.64-38.08a873.28 873.28 0 0 1-57.92 145.28c-19.04 29.44-26.88 54.72-22.88 56.64s26.56-4.8 69.6-17.76 48-15.04 48-12.96a216.8 216.8 0 0 1-35.2 122.24 526.56 526.56 0 0 1-88.96 93.76 67.04 67.04 0 0 0 32 41.6c18.72 8.48 91.2 19.2 90.56 23.2a200.96 200.96 0 0 1-84.96 96c-56.16 28.96-62.88 32-64 36.96s2.88 116.16-1.76 116.96a417.6 417.6 0 0 1-80-14.72c-22.72-7.84-32-15.04-32-16.96a338.88 338.88 0 0 0 45.28-72.16 188 188 0 0 0 12.96-48s73.12 3.36 80-48-30.24-60.96-40.8-62.72a99.52 99.52 0 0 0-21.28-2.56s18.56-164.96-37.28-256-115.36-139.2-236.16-134.24-185.44 68.48-215.04 192-21.76 194.08-21.76 194.08-59.04 2.4-57.12 75.52 78.88 58.56 78.88 58.56a112 112 0 0 0 17.44 62.4c19.52 29.76 28.16 40.96 28.16 40.96s-77.92 29.76-78.56 25.28 20-72.64 17.28-80-16-21.76-20.8-21.76-155.36 6.56-156.8 0 33.44-60 68.32-104.16 52-60.8 51.36-66.88-24.16-33.76-75.36-41.28-71.84-5.92-70.56-8.64a528 528 0 0 1 85.6-87.04 122.72 122.72 0 0 0 40.32-34.88A565.92 565.92 0 0 1 121.76 352c-28.32-53.28-29.92-88.48-28-90.56z" fill="#85BFE9" p-id="2443"></path><path d="M328.48 192a659.68 659.68 0 0 1-13.12-72.32 323.52 323.52 0 0 1 58.56 22.08c0 2.72 0 13.92-1.92 13.92a269.92 269.92 0 0 0-34.56-7.04c0 1.92 5.6 31.2 4.96 33.12s-12.64 12-13.92 10.24zM576 152a253.12 253.12 0 0 1 52.16-34.24c19.2-6.72 16-10.08 19.2-6.72s7.36 13.92 5.44 16a320 320 0 0 0-48 20.96c-15.2 10.08-16 16-19.84 14.72s-7.04-8-8.96-10.72z" fill="#1D1D1B" p-id="2444"></path><path d="M263.68 662.72a432 432 0 0 1 11.2 77.6c-1.92 0-37.92-4.32-38.08-30.24a60 60 0 0 1 26.88-47.36zM775.84 663.36c2.08-2.08 37.92 0 32 31.04s-44.64 41.6-45.44 37.44a358.4 358.4 0 0 1 10.4-37.28c4.48-18.72-0.96-27.2 3.04-31.2zM499.2 275.52c64 0 141.6 3.52 202.08 109.28s53.92 189.6 37.44 284.16-42.72 151.2-59.04 169.12a182.24 182.24 0 0 1-20.48 20.8 250.56 250.56 0 0 0-39.36-25.6c-3.36 1.28-8 6.08-6.56 8.64s32 24.32 30.72 26.4-18.56 14.08-20.48 12.16a416 416 0 0 0-39.36-30.24c-2.72 0-10.56 6.08-9.28 8.64s38.08 26.24 34.08 28.96-25.12 12.16-27.84 10.24-30.88-31.04-33.44-30.88-9.92 4-7.84 7.36 22.88 28.32 22.88 28.32a497.44 497.44 0 0 1-130.24-1.6c-59.2-10.88-100.96-76.32-120-145.92s-19.04-217.76 1.6-299.68 56.8-179.2 185.12-180.16zM483.68 933.92c1.92-1.92 20 1.12 37.92 0s26.56-0.8 26.56 1.12 2.24 29.28 0 29.92a48 48 0 0 1-24.64 0.8 48 48 0 0 0-24-5.12c-6.56 1.44-10.56 6.08-12.64 3.36a98.56 98.56 0 0 1-3.2-30.08z" fill="#E6E4DA" p-id="2445"></path><path d="M367.04 372.96c5.28-1.92 48-27.68 150.56-27.04s160.96 28 162.4 36 0 39.2-5.6 39.2-37.44-22.4-155.04-21.12-151.36 29.28-157.92 24.8-13.6-45.12 5.6-51.84z" fill="#1D1D1B" p-id="2446"></path><path d="M373.76 384c4-8.32 52.32-27.04 149.28-22.4s142.4 20.8 142.4 26.08 3.36 13.92 0 13.92a464 464 0 0 0-146.88-17.6 690.88 690.88 0 0 0-141.92 20.32c-5.44-1.6-4.16-18.24-2.88-20.32z" fill="#85BFE9" p-id="2447"></path><path d="M562.24 448c44.64-18.24 128-4.96 124.96 86.08s-114.08 103.84-151.68 52.96-19.68-120.32 26.72-139.04z" fill="#1D1D1B" p-id="2448"></path><path d="M569.28 462.24c36.64-15.04 104.64-4.16 102.56 70.72S578.08 618.08 547.2 576s-16-98.24 22.08-113.76z" fill="#FFFFFF" p-id="2449"></path><path d="M379.84 445.6c41.12-16.8 117.44-4.64 115.04 80s-105.12 96-139.84 48.8-17.92-111.36 24.8-128.8z" fill="#1D1D1B" p-id="2450"></path><path d="M386.4 458.88c33.76-13.76 96-3.84 94.56 65.12s-86.4 78.56-114.88 40.16-14.08-90.88 20.32-105.28z" fill="#FFFFFF" p-id="2451"></path><path d="M408.16 509.6a17.12 17.12 0 1 1-5.28 27.2 17.92 17.92 0 0 1 5.28-27.2zM596.32 516.64a17.12 17.12 0 1 1-5.28 27.2 17.92 17.92 0 0 1 5.28-27.2zM350.72 603.84a86.88 86.88 0 0 0 48 20.64 143.04 143.04 0 0 0 49.28-4.96c3.36 0.8 3.36 10.4 3.2 12.96a105.12 105.12 0 0 1-60.16 6.24 80 80 0 0 1-48-23.04c-1.44-2.72 5.76-11.84 7.68-11.84zM587.52 633.28a86.88 86.88 0 0 0 52.32 0 143.04 143.04 0 0 0 43.2-23.36c3.36 0 7.2 8.32 8 10.72a105.12 105.12 0 0 1-53.12 28.96 80 80 0 0 1-52.48-3.04c-2.88-1.28 0.16-12.64 2.08-13.28zM476.48 636.64c0-2.08 11.68-4.8 12.48-1.6s-2.24 102.08 25.12 101.44 18.24-101.76 20.8-103.36a35.68 35.68 0 0 1 12.64 0s15.2 121.44-32.8 120.8-38.08-116-38.24-117.28zM354.4 788.8a84.96 84.96 0 0 1 3.04-28c3.84-8.64 16-18.72 18.4-18.08s8 7.2 6.08 9.92-13.92 9.44-14.4 17.44 0 21.92-1.76 22.56a19.52 19.52 0 0 1-11.36-3.84zM625.12 744.16s8.48-10.08 11.2-10.08a43.2 43.2 0 0 1 24.16 23.68c6.08 16 6.24 31.2 1.6 32s-12.64 2.08-12.64 0 6.56-20-0.96-30.56a53.28 53.28 0 0 0-23.36-15.04zM390.08 777.28c3.2 1.12 35.36 23.04 110.4 20.32a443.36 443.36 0 0 0 124.64-24.96 29.76 29.76 0 0 1 2.72 13.28c0 2.72-53.6 29.6-129.92 28.32s-111.04-19.68-112-22.4 2.24-15.2 4.16-14.56z" fill="#1D1D1B" p-id="2452"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.rcode.top/2020/02/11/java/Redis%E5%A4%87%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=349612960,4189726522&fm=26&gp=0.jpg">
      <meta itemprop="name" content="河神">
      <meta itemprop="description" content="你可以跑,但你不能躲">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rick-Code">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis备要
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-11 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-11T00:00:00+08:00">2020-02-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-18 16:47:53" itemprop="dateModified" datetime="2021-02-18T16:47:53+08:00">2021-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>  书单：<br>  《 Redis的设计与实现》<br>        《Netty、Redis、Zookeeper高并发实战》</p>
</blockquote>
<hr>
<h1 id="1-Redis是什么"><a href="#1-Redis是什么" class="headerlink" title="1. Redis是什么"></a>1. Redis是什么</h1><p>Redis是一个C语言开发的高性能Key-Value数据库。</p>
<hr>
<h1 id="2-Redis的使用场景"><a href="#2-Redis的使用场景" class="headerlink" title="2. Redis的使用场景"></a>2. Redis的使用场景</h1><ul>
<li>缓存</li>
<li>分布式锁</li>
<li>GEO可以支持地理位置搜索</li>
<li>消息订阅<h2 id="2-1缓存"><a href="#2-1缓存" class="headerlink" title="2.1缓存"></a>2.1缓存</h2><h3 id="2-1-1-缓存穿透"><a href="#2-1-1-缓存穿透" class="headerlink" title="2.1.1 缓存穿透"></a>2.1.1 缓存穿透</h3>缓存穿透指的客户端不断的查询一个数据库不存在的值，多次缓存都没有命中，缓存失去了存在的意义，导致DB不断被直接访问，产生很大压力，就是缓存穿透。<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3></li>
</ul>
<ol>
<li>布隆过滤器 -&gt;将不存在的数据在布隆过滤器中做过滤</li>
<li>存储空值-&gt;直接将不存在的数据也进行存储，只不过是空值</li>
</ol>
<p>以上方法虽然可以解决缓存穿透，但是有可能会有数据一致性的问题。</p>
<h3 id="2-1-2-缓存击穿"><a href="#2-1-2-缓存击穿" class="headerlink" title="2.1.2 缓存击穿"></a>2.1.2 缓存击穿</h3><p>热点数据缓存失效后，大量请求并发访问，同时去缓存数据，导致的数据库压力暴增。</p>
<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><h3 id="2-1-3-缓存雪崩"><a href="#2-1-3-缓存雪崩" class="headerlink" title="2.1.3 缓存雪崩"></a>2.1.3 缓存雪崩</h3><p> 大量数据同时过期，然后去缓存的适合，引发大量访问数据库，数据库压力过大甚至down机</p>
<h3 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h3><ol>
<li>随机时间过期</li>
<li>缓存永不过期策略</li>
<li>缓存添加锁机制和重试，保证某一个缓存在同一时刻，只能被一个线程缓存，</li>
<li>对于部分新功能增加的热点缓存，可以在程序启动后主动进行缓存 ，进行数据预热</li>
<li>Redis高可用，（集群,见下面集群篇）</li>
</ol>
<h2 id="2-2-缓存一致性的问题"><a href="#2-2-缓存一致性的问题" class="headerlink" title="2.2 缓存一致性的问题"></a>2.2 缓存一致性的问题</h2><p>注意，无论是先写缓存后写数据库，还是先写数据库后写缓存，都是有问题的，因为读写是并发的，都会出现数据不一致的情况。</p>
<h3 id="1-写后删除"><a href="#1-写后删除" class="headerlink" title="1.  写后删除"></a>1.  写后删除</h3><p>在写入数据库成功后，删除缓存，这样在数据访问的适合，重新缓存，就能获取到最新的数据。这种其实也是有几率失败了，如一个读操作没有命中缓存，然后准备存储空的时候，写操作执行了删除，然后读操作在写缓存的时候就是错误的。</p>
<h3 id="2-延时双删"><a href="#2-延时双删" class="headerlink" title="2. 延时双删"></a>2. 延时双删</h3><p>为了解决上面的问题，可以使用延时双删的策略，一般是 删除缓存-&gt;更新数据-&gt;sleep(n) -&gt;删除缓存的方式解决</p>
<h3 id="3-只写缓存"><a href="#3-只写缓存" class="headerlink" title="3. 只写缓存"></a>3. 只写缓存</h3><p>只写缓存，然后异步更新到mysql类似与mq，msyql之类的刷盘机制，即我们只操作缓存，然后通过异步的方式，去更新数据库</p>
<h3 id="4-借助于canal工具更新"><a href="#4-借助于canal工具更新" class="headerlink" title="4.借助于canal工具更新"></a>4.借助于canal工具更新</h3><p>程序只写入数据库，然后另外的线程监听canal，更新缓存</p>
<blockquote>
<p>这里学习了左耳耗子的博客 <a target="_blank" rel="noopener" href="https://coolshell.cn/articles/17416.html">https://coolshell.cn/articles/17416.html</a></p>
</blockquote>
<hr>
<h2 id="2-2-分布式锁"><a href="#2-2-分布式锁" class="headerlink" title="2.2 分布式锁"></a>2.2 分布式锁</h2><h3 id="分布式锁需要满足的条件："><a href="#分布式锁需要满足的条件：" class="headerlink" title="分布式锁需要满足的条件："></a>分布式锁需要满足的条件：</h3><ol>
<li>存储空间 -&gt; zai </li>
<li>唯一标示</li>
<li>至少两个可变状态<h3 id="分布式锁核心概念"><a href="#分布式锁核心概念" class="headerlink" title="分布式锁核心概念"></a>分布式锁核心概念</h3></li>
<li>加锁</li>
<li>解锁</li>
<li>锁超时<h3 id="2-2-1-Redis分布式锁"><a href="#2-2-1-Redis分布式锁" class="headerlink" title="2.2.1 Redis分布式锁"></a>2.2.1 Redis分布式锁</h3></li>
<li>加锁<br>基于set 命令的NX PX/EX 选项来实现加锁(在2.6之后可以用，2.6之前需要使用lua)<br>NX:不存在才设置<br>PX/EX:超时时间（区别 一个毫秒/一个秒）<br>value: 唯一标示字符串，在解锁的时候使用</li>
<li>解锁<br>需要使用LUA脚本，将加锁时候Value的唯一字符串进行判断，如果相同，则说明是当前锁，<h4 id="redisson实现了基于Redis的分布式锁"><a href="#redisson实现了基于Redis的分布式锁" class="headerlink" title="redisson实现了基于Redis的分布式锁"></a>redisson实现了基于Redis的分布式锁</h4></li>
</ol>
<h3 id="2-2-2-ZK实现的分布式锁"><a href="#2-2-2-ZK实现的分布式锁" class="headerlink" title="2.2.2 ZK实现的分布式锁"></a>2.2.2 ZK实现的分布式锁</h3><ul>
<li><p>最基本的是利用ZK节点不能重复的特性，来实现分布式锁，但是这样可能产生惊群效应</p>
</li>
<li><p>ZK中还有一种名为临时节点的节点，临时节点由某个客户端创建，当客户端与ZK集群断开连接，则该节点自动被删除。EPHEMERAL_SEQUENTIAL为临时顺序节点。</p>
</li>
<li><p>ZK临时顺序节点是天然的发号器</p>
</li>
<li><p>ZK的递增节点可以保证锁的公平性</p>
</li>
<li><p>ZK的节点监听可以保证节点的锁的传递</p>
</li>
<li><p>ZK的节点监听可以避免惊群效应</p>
</li>
</ul>
<h4 id="加锁过程"><a href="#加锁过程" class="headerlink" title="加锁过程"></a>加锁过程</h4><ol>
<li>在一个永久节点下面创建一个临时节点，然后判断自己是否是最小的那个节点，如果不是，就监听前一个节点</li>
<li>如果监听到前一个节点释放，就判断自己是否是最小的那个节点，如果是则加锁成功，否则持续监听，</li>
<li>完成后删除自己的节点，进行锁释放工作</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>性能不高</p>
<h5 id="Menagerie-实现了基于ZK的分布式锁"><a href="#Menagerie-实现了基于ZK的分布式锁" class="headerlink" title="Menagerie 实现了基于ZK的分布式锁"></a>Menagerie 实现了基于ZK的分布式锁</h5><h3 id="分布式锁选择"><a href="#分布式锁选择" class="headerlink" title="分布式锁选择"></a>分布式锁选择</h3><blockquote>
<p>并发高，性能要求高redis ,高可靠，高可用，公平，ZK</p>
</blockquote>
<ul>
<li>基于Redis的分布式锁。适用于并发量很大、性能要求很高而可靠性问题可以通过其他方案去弥补的场景。</li>
<li>基于ZooKeeper的分布式锁。适用于高可靠（高可用），而并发量不是太高的场景。</li>
</ul>
<hr>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>Redis服务器默认会创建16个数据库，自定义是由 db num属性决定的</p>
<h2 id="数据库键空间"><a href="#数据库键空间" class="headerlink" title="数据库键空间"></a>数据库键空间</h2><ul>
<li>dict字典保存了数据库中的所有键值对，我们将这个字典称为键空间（key space）</li>
<li>在读取一个键之后，服务器会更新键的LRU（最后一次使用）时间，这个值可以用于计算键的闲置时间，使用OBJECT idletime命令可以查看键key的闲置时间。</li>
<li>在读取一个键之后（读操作和写操作都要对键进行读取），服务器会根据键是否存在来更新服务器的键空间命中（hit）次数或键空间不命中（miss）次数，这两个值可以在INFO stats命令的keyspace_hits属性和keyspace_misses属性中查看。</li>
</ul>
<h2 id="key的过期时间"><a href="#key的过期时间" class="headerlink" title="key的过期时间"></a>key的过期时间</h2><ul>
<li>redisDb结构的expires字典保存了数据库中所有键的过期时间，我们称这个字典为过期字典</li>
<li>过期字典的键是一个指针，这个指针指向键空间中的某个键对象（也即是某个数据库键）</li>
<li>过期字典的值是一个long 类型的整数，这个整数保存了键所指向的数据库键的过期时间——一个毫秒精度的UNIX时间戳。<h3 id="过期键的判定"><a href="#过期键的判定" class="headerlink" title="过期键的判定"></a>过期键的判定</h3>1）检查给定键是否存在于过期字典：如果存在，那么取得键的过期时间。2）检查当前UNIX时间戳是否大于键的过期时间：如果是的话，那么键已经过期；否则的话，键未过期。<h3 id="过期键的删除策略"><a href="#过期键的删除策略" class="headerlink" title="过期键的删除策略"></a>过期键的删除策略</h3></li>
<li>定时删除：在设置键的过期时间的同时，创建一个定时器（timer），让定时器在键的过期时间来临时，立即执行对键的删除操作。对内存是友好的，可以保证键被尽快删除，但是如果过多键同时到期，对cpu极度不友好，影响服务器的响应时间。</li>
<li>惰性删除：放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键；如果没有过期，就返回该键。对内存不友好，可能造成内存中存在很多过期的数据，有内存泄漏的危险。但是对cpu是友好的，因为只有在用的时候才回去清楚。</li>
<li>定期删除：每隔一段时间，程序就对数据库进行一次检查，删除里面的过期键。至于要删除多少过期键，以及要检查多少个数据库，则由算法决定。</li>
</ul>
<h3 id="AOF和RDB对过期的处理"><a href="#AOF和RDB对过期的处理" class="headerlink" title="AOF和RDB对过期的处理"></a>AOF和RDB对过期的处理</h3><ul>
<li>AOF: 在键没有被删除的时候是没有任何影响的，删除的键会产生一个DEL语句，在AOF重写的过程中，会把DEL的语句优化掉。</li>
<li>RDB: 过期的键不会载入RDB文件，从RDB文件加载的时候，过期的键也不会加载到内存<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3>当服务器运行在复制模式下时，从服务器的过期键删除动作由主服务器控制，从服务器不会去主动删除。当主服务器删除一个过期键之后，它会向所有从服务器发送一条DEL命令，显式地删除过期键</li>
</ul>
<hr>
<h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><ul>
<li>服务器中的非空数据库以及它们的键值对统称为数据库状态。</li>
<li>RDB将Redis在内存中的数据库状态保存到磁盘里面，避免数据意外丢失。</li>
<li>RDB可以手动执行也可以自动执行</li>
<li>SAVE命令 和 BGSAVE命令都可以生产RDB文件。</li>
<li>SAVE命令会阻塞Redis服务器进程，直到RDB文件创建完毕为止，在服务器进程阻塞期间，服务器不能处理任何命令请求：</li>
<li>BGSAVE命令会派生出一个子进程，然后由子进程负责创建RDB文件，服务器进程（父进程）继续处理命令请求：</li>
<li>如果开启AOF,则默认使用AOF,因为AOF更新频率更高<br><img src="https://upload-images.jianshu.io/upload_images/13349286-1071625264fa0153.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="数据库恢复"></li>
<li>服务器在载入RDB文件期间，会一直处于阻塞状态，直到载入工作完成为止。</li>
<li>自动间隔性保存：服务器状态中会保存所有用save选项设置的保存条件，当任意一个保存条件被满足时，服务器会自动执行BGSAVE命令。包括像多少时间进行了多少次修改，</li>
<li>Redis的服务器周期性操作函数serverCron默认每隔100毫秒就会执行一次，该函数用于对正在运行的服务器进行维护，它的其中一项工作就是检查save选项所设置的保存条件是否已经满足，如果满足的话，就执行BGSAVE命令。</li>
<li>对于不同类型的键值对，RDB文件会使用不同的方式来保存它们。</li>
</ul>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><ul>
<li>AOF持久化是通过保存Redis服务器所执行的写命令来记录数据库状态的</li>
<li>AOF写入时机：每次在结束文件事件前，都会考虑是否把新内容添加到AOF缓冲区中，AOF缓冲区有三种方式刷盘，1 每次刷盘 2. 每隔1s刷 3. 等缓冲区满后刷新</li>
<li>AOF文件的读取，创建伪客户端，由伪客户端一条一条的执行AOF日志，直到执行完毕</li>
</ul>
<h3 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h3><ul>
<li>重写是在子进程中完成</li>
<li>重写和原AOF文件无关，根据数据库当前状态，生成一份新的AOF文件</li>
<li>在重写的过程中，会维持一个重写缓冲区，在重写过程中执行的命令都是在缓冲区进行记录，在重写完成后追加到新文件结尾，然后替换旧的文件，完成一个重写。</li>
</ul>
<hr>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p>Redis服务器是一个事件驱动程序，服务器需要处理文件事件和事件事件</p>
<h2 id="文件事件"><a href="#文件事件" class="headerlink" title="文件事件"></a>文件事件</h2><ul>
<li>文件事件处理器是基于Reactor模式实现的网络通信程序。</li>
<li>文件事件处理器使用I/O多路复用（multiplexing）程序来同时监听多个套接字，并根据套接字目前执行的任务来为套接字关联不同的事件处理器。</li>
<li>当被监听的套接字准备好执行连接应答（accept）、读取（read）、写入（write）、关闭（close）等操作时，与操作相对应的文件事件就会产生，这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。<br><img src="https://upload-images.jianshu.io/upload_images/13349286-8b39131c2f6ea462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="处理过程"></li>
<li>当多个IO事件发生的时候，IO复用程序会将所有的套接字放在一个队列中，以有序，同步，一个一个的处理套接字。当上一个处理完成之后，才会去处理下一个套接字，这也就是为什么总有人说Redis是单线程的原因。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-6d323150658f06c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="事件处理队列"></p>
<h2 id="时间事件"><a href="#时间事件" class="headerlink" title="时间事件"></a>时间事件</h2><ul>
<li>服务器在一般情况下只执行serverCron函数一个时间事件，并且这个事件是周期性事件。</li>
</ul>
<h2 id="事件的调度与执行"><a href="#事件的调度与执行" class="headerlink" title="事件的调度与执行"></a>事件的调度与执行</h2><ul>
<li>文件事件和时间事件之间是合作关系，服务器会轮流处理这两种事件，并且处理事件的过程中也不会进行抢占。</li>
<li>时间事件的实际处理时间通常会比设定的到达时间晚一些。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/13349286-ff359fcdfa5b4b10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="事件的调度"></p>
<h1 id="serverCron函数"><a href="#serverCron函数" class="headerlink" title="serverCron函数"></a>serverCron函数</h1><p>Redis服务器中的serverCron函数默认每隔100毫秒执行一次，这个函数负责管理服务器的资源，并保持服务器自身的良好运转。</p>
<h3 id="更新服务器时间缓存"><a href="#更新服务器时间缓存" class="headerlink" title="更新服务器时间缓存"></a>更新服务器时间缓存</h3><ul>
<li>在精度要求不高的情况下，如果需要获得时间信息，Redis是直接从缓存获取，一般包括日志，是否持久化等情况下<h3 id="更新LRU时间信息"><a href="#更新LRU时间信息" class="headerlink" title="更新LRU时间信息"></a>更新LRU时间信息</h3></li>
<li>每个Redis对象都会有一个lru属性，这个lru属性保存了对象最后一次被命令访问的时间</li>
</ul>
<hr>
<h1 id="Redis的淘汰策略"><a href="#Redis的淘汰策略" class="headerlink" title="Redis的淘汰策略"></a>Redis的淘汰策略</h1><ul>
<li>从已经设置过期时间的key中挑选最近最少使用的</li>
<li>从已经设置过期时间的key中最快过期的</li>
<li>从已经设置过期时间的key随机淘汰</li>
<li>从整个数据选择最近最少使用</li>
<li>从整个数据随机淘汰</li>
<li>不淘汰</li>
</ul>
<hr>
<h1 id="Redis高可用"><a href="#Redis高可用" class="headerlink" title="Redis高可用"></a>Redis高可用</h1><h2 id="1-复制"><a href="#1-复制" class="headerlink" title="1.  复制"></a>1.  复制</h2><ul>
<li> 基于RDB实现初始化，也就是同步操作，使用AOF实现同步复制，也就是命令传播</li>
<li>缺点：不支持自动扩容，没有高可用，可能产生数据不一致的问题<h3 id="旧版复制功能"><a href="#旧版复制功能" class="headerlink" title="旧版复制功能"></a>旧版复制功能</h3><h4 id="同步操作-SYNC命令"><a href="#同步操作-SYNC命令" class="headerlink" title="同步操作 - SYNC命令"></a>同步操作 - SYNC命令</h4><img src="https://upload-images.jianshu.io/upload_images/13349286-dc2a345e872321ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="复制过程"><h4 id="复制的时机"><a href="#复制的时机" class="headerlink" title="复制的时机"></a>复制的时机</h4></li>
<li>从初次连接同步主的内容</li>
<li>从断线之后，再次去同步主的内容<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4></li>
<li>同步十分低效，耗费大量的资源</li>
<li>在断线重联的情况下，大部分数据是相同的，但是还是要执行全量同步<h4 id="命令传播"><a href="#命令传播" class="headerlink" title="命令传播"></a>命令传播</h4>在同步操作完成后，暂时主从一致，但是如果主一旦发生写操作，主会将写操作命令发送给从，从服务其执行后，再次回到一致的状态<h3 id="新版复制功能"><a href="#新版复制功能" class="headerlink" title="新版复制功能"></a>新版复制功能</h3><h4 id="PSYNC命令"><a href="#PSYNC命令" class="headerlink" title="PSYNC命令"></a>PSYNC命令</h4></li>
<li>在初次同步相同，但是断线重联的时候，只会发送在断线期间执行的写操作，而不是全量同步</li>
<li>主从维持着一个复制的偏移量，通过偏移量，很容易就知道主从是否一致</li>
<li>在主发送写操作的时候，同时会将写操作保存在一个固定队列中，这样，如果重联只会的偏移量在队列中，就可以迅速使用队列中的命令进行恢复</li>
</ul>
<h3 id="心跳检测"><a href="#心跳检测" class="headerlink" title="心跳检测"></a>心跳检测</h3><p>在命令传播的阶段，从服务器会每秒1次向主服务器发送心跳请求<br>用来：</p>
<ul>
<li>检测主从服务器的网络连接状态</li>
<li>辅助实现min-slaves配置选项，主服务会检测从服务器最少多少个，延迟多少的时候才写入数据。</li>
<li>检测命令丢失<h2 id="2-哨兵"><a href="#2-哨兵" class="headerlink" title="2. 哨兵"></a>2. 哨兵</h2>基于主从复制，可以自动实现切换主从结构</li>
<li>哨兵由一个或者多个组成哨兵集群</li>
<li>哨兵检测主从所有的节点</li>
<li>当主节点挂掉的时候，哨兵会从其中一个从节点挑选一个作为主节点，当挂掉的主节点从新上线后，会降级当前主节点的从节点。<h2 id="3-Cluster"><a href="#3-Cluster" class="headerlink" title="3. Cluster"></a>3. Cluster</h2></li>
<li>实际上辅助和哨兵至是实现了Redis的高可用，但是其每一个机器都是存储完整数据，资源浪费很严重</li>
<li>节点通过握手来将其他节点添加到自己所处的集群当中。</li>
<li>集群的整个数据库被分为16384个槽（slot），数据库中的每个键都属于这16384个槽的其中一个，集群中的每个节点可以处理0个或最多16384个槽。</li>
<li>集群中的16384个槽可以分别指派给集群中的各个节点，每个节点都会记录哪些槽指派给了自己，而哪些槽又被指派给了其他节点。</li>
<li>在Cluster执行lua脚本的时候，会有一定的问题，因为Redis要求执行lua的脚本都在一个节点上面，如果你的lua脚本包含多个节点，就会报错，解决方法是在key中增加{}，如果key中包含{}, 就会使用第一个{}内部的字符串作为hash key，这样就可以保证拥有同样{}内部字符串的key就会拥有相同slot。</li>
<li>节点在接到一个命令请求时，会先检查这个命令请求要处理的键所在的槽是否由自己负责，如果不是的话，节点将向客户端返回一个MOVED错误，MOVED错误携带的信息可以指引客户端转向至正在负责相关槽的节点。</li>
<li>使用了跳跃表来保存槽和键之间的关系</li>
<li>重新分片： 将节点A的槽数据至节点B，Redis使用了redis-trib来实现。<ul>
<li>过程：1. 通知A做好准备，2，通知B做好准备 3，获取n个键值 4，发送migrate命令，将选中的进行迁移 5，重复直到复制完成 6，将指派信息通知集群。</li>
</ul>
</li>
<li>ask错误：如果节点A正在迁移槽i至节点B，那么当节点A没能在自己的数据库中找到命令指定的数据库键时，节点A会向客户端返回一个ASK错误，指引客户端到节点B继续查找指定的数据库键。</li>
<li>  Redis集群中的节点分为主节点（master）和从节点（slave），其中主节点用于处理槽，而从节点则用于复制某个主节点，并在被复制的主节点下线时，代替下线主节点继续处理命令请求。</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"><i class="fa fa-tag"></i> Redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/10/java/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" rel="prev" title="领域驱动设计">
      <i class="fa fa-chevron-left"></i> 领域驱动设计
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/02/12/linux/%E3%80%90linux%E7%AC%94%E8%AE%B0%E3%80%91java%E7%8E%AF%E5%A2%83/" rel="next" title="【linux笔记】java环境">
      【linux笔记】java环境 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Redis%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.</span> <span class="nav-text">1. Redis是什么</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Redis%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">2. Redis的使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1%E7%BC%93%E5%AD%98"><span class="nav-number">2.1.</span> <span class="nav-text">2.1缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.1.1 缓存穿透</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3"><span class="nav-number">2.1.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.1.2 缓存击穿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-1"><span class="nav-number">2.1.4.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-number">2.1.5.</span> <span class="nav-text">2.1.3 缓存雪崩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-2"><span class="nav-number">2.1.6.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 缓存一致性的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%86%99%E5%90%8E%E5%88%A0%E9%99%A4"><span class="nav-number">2.2.1.</span> <span class="nav-text">1.  写后删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BB%B6%E6%97%B6%E5%8F%8C%E5%88%A0"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. 延时双删</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%8F%AA%E5%86%99%E7%BC%93%E5%AD%98"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 只写缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%80%9F%E5%8A%A9%E4%BA%8Ecanal%E5%B7%A5%E5%85%B7%E6%9B%B4%E6%96%B0"><span class="nav-number">2.2.4.</span> <span class="nav-text">4.借助于canal工具更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.3.</span> <span class="nav-text">2.2 分布式锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%9C%80%E8%A6%81%E6%BB%A1%E8%B6%B3%E7%9A%84%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="nav-number">2.3.1.</span> <span class="nav-text">分布式锁需要满足的条件：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">2.3.2.</span> <span class="nav-text">分布式锁核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.3.3.</span> <span class="nav-text">2.2.1 Redis分布式锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#redisson%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%9F%BA%E4%BA%8ERedis%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">redisson实现了基于Redis的分布式锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-ZK%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.3.4.</span> <span class="nav-text">2.2.2 ZK实现的分布式锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E9%94%81%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">加锁过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">2.3.5.</span> <span class="nav-text">缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Menagerie-%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%9F%BA%E4%BA%8EZK%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.3.5.0.1.</span> <span class="nav-text">Menagerie 实现了基于ZK的分布式锁</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%80%89%E6%8B%A9"><span class="nav-number">2.3.6.</span> <span class="nav-text">分布式锁选择</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">3.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.1.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%AE%E7%A9%BA%E9%97%B4"><span class="nav-number">3.2.</span> <span class="nav-text">数据库键空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#key%E7%9A%84%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="nav-number">3.3.</span> <span class="nav-text">key的过期时间</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%88%A4%E5%AE%9A"><span class="nav-number">3.3.1.</span> <span class="nav-text">过期键的判定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5"><span class="nav-number">3.3.2.</span> <span class="nav-text">过期键的删除策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF%E5%92%8CRDB%E5%AF%B9%E8%BF%87%E6%9C%9F%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">3.3.3.</span> <span class="nav-text">AOF和RDB对过期的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">3.3.4.</span> <span class="nav-text">主从复制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB"><span class="nav-number">4.1.</span> <span class="nav-text">RDB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF"><span class="nav-number">4.2.</span> <span class="nav-text">AOF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF%E9%87%8D%E5%86%99"><span class="nav-number">4.2.1.</span> <span class="nav-text">AOF重写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">事件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6"><span class="nav-number">5.1.</span> <span class="nav-text">文件事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6"><span class="nav-number">5.2.</span> <span class="nav-text">时间事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%B0%83%E5%BA%A6%E4%B8%8E%E6%89%A7%E8%A1%8C"><span class="nav-number">5.3.</span> <span class="nav-text">事件的调度与执行</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#serverCron%E5%87%BD%E6%95%B0"><span class="nav-number">6.</span> <span class="nav-text">serverCron函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E9%97%B4%E7%BC%93%E5%AD%98"><span class="nav-number">6.0.1.</span> <span class="nav-text">更新服务器时间缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0LRU%E6%97%B6%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="nav-number">6.0.2.</span> <span class="nav-text">更新LRU时间信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E7%9A%84%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="nav-number">7.</span> <span class="nav-text">Redis的淘汰策略</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">8.</span> <span class="nav-text">Redis高可用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%A4%8D%E5%88%B6"><span class="nav-number">8.1.</span> <span class="nav-text">1.  复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A7%E7%89%88%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD"><span class="nav-number">8.1.1.</span> <span class="nav-text">旧版复制功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%93%8D%E4%BD%9C-SYNC%E5%91%BD%E4%BB%A4"><span class="nav-number">8.1.1.1.</span> <span class="nav-text">同步操作 - SYNC命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="nav-number">8.1.1.2.</span> <span class="nav-text">复制的时机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">8.1.1.3.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E4%BC%A0%E6%92%AD"><span class="nav-number">8.1.1.4.</span> <span class="nav-text">命令传播</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E7%89%88%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD"><span class="nav-number">8.1.2.</span> <span class="nav-text">新版复制功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PSYNC%E5%91%BD%E4%BB%A4"><span class="nav-number">8.1.2.1.</span> <span class="nav-text">PSYNC命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B"><span class="nav-number">8.1.3.</span> <span class="nav-text">心跳检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%93%A8%E5%85%B5"><span class="nav-number">8.2.</span> <span class="nav-text">2. 哨兵</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Cluster"><span class="nav-number">8.3.</span> <span class="nav-text">3. Cluster</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="河神"
      src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=349612960,4189726522&fm=26&gp=0.jpg">
  <p class="site-author-name" itemprop="name">河神</p>
  <div class="site-description" itemprop="description">你可以跑,但你不能躲</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/40227ed13cdc" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;40227ed13cdc" rel="noopener" target="_blank">简书</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">河神</span>
</div>


<a class="theme-link" target="_blank" href="https://www.jianshu.com/u/40227ed13cdc">桃花深处有人家</a>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_lines.min.js"></script>


  















  

  


  <script type="text/javascript" src="/js/click.js"></script>

</body>
</html>
